<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OvaCare - Women's Health Assistance Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --primary-color: #8e44ad;
            --secondary-color: #f8e6ff;
            --accent-color: #ffccd5;
            --text-color: #2c3e50;
            --light-text: #7f8c8d;
            --white: #ffffff;
            --border-radius: 16px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            --gradient-primary: linear-gradient(135deg, #8e44ad, #9b59b6);
            --gradient-secondary: linear-gradient(135deg, #f8e6ff, #e6ccff);
            --gradient-accent: linear-gradient(135deg, #ffccd5, #ffb6c1);
            --gradient-hero: linear-gradient(135deg, rgba(142, 68, 173, 0.9), rgba(155, 89, 182, 0.9));
            --gradient-luxury: linear-gradient(135deg, #8e44ad, #3498db, #e74c3c);
            --gradient-luxury-light: linear-gradient(135deg, rgba(142, 68, 173, 0.05), rgba(52, 152, 219, 0.05), rgba(231, 76, 60, 0.05));
            --risk-low: #4CAF50;
            --risk-medium: #FF9800;
            --risk-high: #F44336;
            --chatbot-bg: linear-gradient(135deg, #f8e6ff, #e6ccff);
            --chatbot-user-bg: linear-gradient(135deg, #ffccd5, #ffb6c1);
            --chatbot-text: #2c3e50;
            --chatbot-user-text: #ffffff;
            --gold: #d4af37;
            --platinum: #e5e4e2;
            --silver: #c0c0c0;
            --success-color: #27ae60;
            --error-color: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #fafbfc;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-size: 16px;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            line-height: 1.2;
        }

        /* Fitness Tracker Card */
        #fitness .card {
            background: linear-gradient(135deg, #f8fafc 0%, #e0c3fc 100%);
            border-radius: 24px;
            box-shadow: 0 4px 24px rgba(142,68,173,0.10);
            padding: 48px 40px;
            max-width: 1000px;
            margin: 40px auto;
            animation: fadeIn 0.7s;
            width: 95%
        }
        #fitness h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: #8e44ad;
            margin-bottom: 24px;
            text-align: center;
            letter-spacing: 1px;
        }
        #fitnessForm label {
            display: block;
            margin: 18px 0 6px 0;
            font-weight: 500;
            color: #6c3483;
            font-size: 1.08rem;
        }
        #fitnessForm input[type="number"] {
            width: 100%;
            padding: 10px 14px;
            border: 1.5px solid #d2b4de;
            border-radius: 8px;
            font-size: 1rem;
            background: #f4f6fb;
            margin-bottom: 8px;
            transition: border-color 0.2s;
        }
        #fitnessForm input[type="number"]:focus {
            border-color: #8e44ad;
            outline: none;
        }
        #fitnessForm .btn {
            display: block;
            width: 100%;
            margin: 24px 0 0 0;
            padding: 12px 0;
            background: linear-gradient(90deg, #8e44ad 0%, #6c3483 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(142,68,173,0.10);
            transition: background 0.2s, transform 0.2s;
        }
        #fitnessForm .btn:hover {
            background: linear-gradient(90deg, #6c3483 0%, #8e44ad 100%);
            transform: scale(1.03);
        }
        #fitnessSummary {
            max-width: 950px; 
            margin: 32px auto 0 auto;
            width: 100%;
            background: #f8f4fc;
            border-radius: 12px;
            padding: 24px 20px;
            box-shadow: 0 2px 8px rgba(142,68,173,0.07);
            font-size: 1.08rem;
            color: #4a235a;
            animation: fadeIn 0.7s;
        }
        #fitnessSummary h3 {
            color: #8e44ad;
            font-size: 1.2rem;
            margin-bottom: 12px;
            text-align: center;
        }
        #fitnessSummary ul {
            list-style: none;
            padding: 0;
            margin: 0 0 12px 0;
        }
        #fitnessSummary ul li {
            padding: 6px 0;
            border-bottom: 1px solid #e0c3fc;
            font-size: 1rem;
        }
        #fitnessSummary ul li:last-child {
            border-bottom: none;
        }
        #fitnessSummary p {
            text-align: center;
            font-weight: 500;
            color: #6c3483;
            margin-top: 10px;
            font-size: 1.08rem;
        }
        .ai-markdown {
            margin-top: 16px;
            background: #f8f4fc;
            border-radius: 12px;
            padding: 18px 16px;
            box-shadow: 0 2px 8px rgba(142,68,173,0.07);
            font-size: 1.08rem;
            color: #4a235a;
            line-height: 1.7;
        }
        .ai-markdown h3, .ai-markdown h4 {
            color: #8e44ad;
            margin-top: 18px;
            margin-bottom: 8px;
            font-family: 'Playfair Display', serif;
        }
        .ai-markdown ul {
            margin: 12px 0 12px 24px;
            padding: 0;
        }
        .ai-markdown li {
            margin-bottom: 8px;
            font-size: 1rem;
        }
        .ai-markdown strong {
            color: #6c3483;
        }
        .ai-markdown p {
            margin: 10px 0;
        }
        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            background: var(--gradient-primary);
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('https://picsum.photos/seed/luxurywomenshealth/1920/1080.jpg');
            background-size: cover;
            background-position: center;
            opacity: 0.15;
            z-index: -1;
        }

        .login-card {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 3rem;
            width: 100%;
            max-width: 450px;
            text-align: center;
            backdrop-filter: blur(10px);
            transform: translateY(0);
            transition: var(--transition);
        }

        .login-card:hover {
            transform: translateY(-5px);
        }

        .login-logo {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 1rem;
        }

        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e1e8ed;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.1);
        }

        .form-control:hover {
            border-color: #d1d9e0;
        }

        .form-control.error {
            border-color: var(--error-color);
            background-color: #fdf2f2;
            animation: shake 0.5s;
        }

        .form-control.success {
            border-color: var(--success-color);
            background-color: #f2fdf5;
        }

        .form-control.error:focus {
            border-color: var(--error-color);
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .form-control.success:focus {
            border-color: var(--success-color);
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .error-message {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .form-control.error + .error-message {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn {
            background: var(--gradient-primary);
            color: var(--white);
            border: none;
            padding: 1rem 2rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: var(--white);
        }

        .btn-cta {
            background: var(--gradient-luxury);
            font-size: 1.1rem;
            padding: 1.2rem 2.5rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .login-error {
            color: var(--error-color);
            margin-top: 0.5rem;
            font-size: 0.9rem;
            display: none;
        }

        /* removed: .demo-note (demo credentials note no longer shown) */

        /* Main App Styles (hidden initially) */
        .app-container {
            display: none;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background: var(--white);
            color: var(--text-color);
            padding: 1rem 0;
            position: fixed;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
            border-radius: 0 0 32px 32px; /* Rounded bottom edges */
            transition: box-shadow 0.3s;
        }

        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo span:first-child {
            color: var(--primary-color);
        }

        nav {
            flex: 1;
            display: flex;
            justify-content: center;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        nav button {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
            position: relative;
        }

        nav button::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--gradient-primary);
            transition: var(--transition);
            transform: translateX(-50%);
        }

        nav button:hover::after, nav button.active::after {
            width: 80%;
        }

        nav button:hover, nav button.active {
            color: var(--primary-color);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-name {
            font-size: 1rem;
            font-weight: 500;
        }

        .logout-btn {
            background: none;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: var(--primary-color);
            color: var(--white);
        }

        main {
            padding: 3rem 0;
            flex: 1;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2.5rem;
            margin-bottom: 2rem;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: var(--text-color);
            margin-bottom: 1.5rem;
            font-size: 2.5rem;
        }

        /* Landing Page Styles */
        .landing-hero {
            position: relative;
            padding: 6rem 0;
            text-align: center;
            color: var(--white);
            background: var(--gradient-hero);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 3rem;
        }

        .landing-hero::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('https://picsum.photos/seed/womenshealthluxury/1920/800.jpg');
            background-size: cover;
            background-position: center;
            opacity: 0.2;
            z-index: -1;
        }

        .landing-hero h1 {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            position: relative;
            letter-spacing: 1px;
            font-weight: 700;
        }

        .landing-hero p {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto 2rem;
            position: relative;
            line-height: 1.7;
            font-weight: 400;
        }

        .pcos-info {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 3rem;
            margin-bottom: 3rem;
        }

        .pcos-info h2 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .pcos-info p {
            margin-bottom: 1.5rem;
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .pcos-symptoms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .symptom-card {
            background: var(--gradient-secondary);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }

        .symptom-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .symptom-icon {
            font-size: 2rem;
            color: var(--primary-color);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .feature-card {
            background: var(--gradient-secondary);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2.5rem;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: var(--transition);
            z-index: -1;
        }

        .feature-card:hover::before {
            opacity: 0.1;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .feature-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        .feature-title {
            font-size: 1.8rem;
            color: var(--text-color);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .feature-description {
            color: var(--light-text);
            font-size: 1rem;
            line-height: 1.6;
        }

        /* Main Feature Highlight */
        .main-feature {
            background: var(--gradient-luxury-light);
            border-radius: var(--border-radius);
            padding: 3rem;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }

        .main-feature::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--gradient-luxury);
        }

        .main-feature-content {
            display: flex;
            align-items: center;
            gap: 3rem;
        }

        .main-feature-text {
            flex: 1;
        }

        .main-feature-title {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-color);
        }

        .main-feature-description {
            font-size: 1.2rem;
            line-height: 1.7;
            margin-bottom: 2rem;
        }

        .main-feature-image {
            flex: 1;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        .main-feature-image img {
            width: 100%;
            height: auto;
            display: block;
            transition: var(--transition);
        }

        .main-feature-image:hover img {
            transform: scale(1.05);
        }

        .main-feature-cta {
            display: inline-block;
            background: var(--gradient-primary);
            color: var(--white);
            padding: 1rem 2rem;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: var(--transition);
        }

        .main-feature-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Secondary Features */
        .secondary-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .secondary-feature {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .secondary-feature:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .secondary-feature-icon {
            font-size: 3rem;
            min-width: 60px;
            text-align: center;
            color: var(--primary-color);
        }

        .secondary-feature-content h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .secondary-feature-content p {
            font-size: 1rem;
            color: var(--light-text);
        }

        /* Enhanced Risk Prediction Styles */
        .prediction-wizard {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .prediction-wizard::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-luxury);
        }

        .wizard-header {
            background: var(--gradient-primary);
            padding: 2rem;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .wizard-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .wizard-header h2 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .wizard-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            border-radius: 4px;
            margin-top: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #fff, var(--gold));
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .step-indicators {
            display: flex;
            justify-content: center;
            gap: 2rem;
            padding: 2rem;
            background: var(--gradient-secondary);
            position: relative;
        }

        .step-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            cursor: pointer;
            transition: var(--transition);
        }

        .step-indicator::before {
            content: "";
            position: absolute;
            top: 20px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: #ddd;
            z-index: -1;
        }

        .step-indicator:last-child::before {
            display: none;
        }

        .step-indicator.active::before {
            background: var(--gradient-primary);
        }

        .step-indicator.completed::before {
            background: var(--gradient-primary);
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 3px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #999;
            transition: var(--transition);
            position: relative;
            z-index: 1;
        }

        .step-indicator.active .step-circle {
            background: var(--gradient-primary);
            border-color: var(--primary-color);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(142, 68, 173, 0.3);
        }

        .step-indicator.completed .step-circle {
            background: var(--gradient-primary);
            border-color: var(--primary-color);
            color: white;
        }

        .step-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #666;
            text-align: center;
            max-width: 100px;
        }

        .step-indicator.active .step-label {
            color: var(--primary-color);
            font-weight: 600;
        }

        .wizard-content {
            padding: 3rem;
            min-height: 500px;
        }

        .step-content {
            display: none;
            animation: slideIn 0.5s ease;
        }

        .step-content.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .step-title {
            font-size: 2rem;
            color: var(--text-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .step-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
        }

        .step-description {
            color: var(--light-text);
            font-size: 1.1rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .form-section {
            margin-bottom: 2rem;
        }

        .form-section-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 1rem;
            color: var(--text-color);
        }

        .form-group label .required {
            color: var(--error-color);
            margin-left: 0.25rem;
        }

        .wizard-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2rem 3rem;
            background: var(--gradient-secondary);
            border-top: 1px solid #e1e8ed;
        }

        .btn-prev {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 0.75rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-prev:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.3);
        }

        .btn-next {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn-next::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.5s ease;
        }

        .btn-next:hover::before {
            left: 100%;
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.3);
        }

        .btn-submit {
            background: var(--gradient-luxury);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn-submit::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.5s ease;
        }

        .btn-submit:hover::before {
            left: 100%;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(142, 68, 173, 0.4);
        }

        .step-summary {
            background: var(--gradient-luxury-light);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border-left: 4px solid var(--primary-color);
        }

        .summary-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(142, 68, 173, 0.1);
        }

        .summary-label {
            font-weight: 500;
            color: var(--light-text);
        }

        .summary-value {
            font-weight: 600;
            color: var(--text-color);
        }

        /* Risk Result Styles */
        .risk-result {
            display: none;
            margin-top: 2rem;
            animation: fadeInUp 0.8s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .risk-result.show {
            display: block;
        }

        .risk-header {
            text-align: center;
            padding: 3rem;
            background: var(--gradient-secondary);
            border-radius: 20px;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .risk-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(142, 68, 173, 0.05) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .risk-score {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .risk-label {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .risk-bar-container {
            max-width: 600px;
            margin: 2rem auto;
            position: relative;
            z-index: 1;
        }

        .risk-bar {
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .risk-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 2s ease;
            position: relative;
            overflow: hidden;
        }

        .risk-fill::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        .risk-percentage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 600;
            color: var(--text-color);
            font-size: 1.1rem;
        }

        .risk-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .risk-info {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .risk-level {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            border-radius: 12px;
            background: var(--gradient-secondary);
        }

        .risk-indicator {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .risk-low .risk-indicator {
            background: var(--risk-low);
        }

        .risk-medium .risk-indicator {
            background: var(--risk-medium);
        }

        .risk-high .risk-indicator {
            background: var(--risk-high);
        }

        .risk-text {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .risk-low .risk-text {
            color: var(--risk-low);
        }

        .risk-medium .risk-text {
            color: var(--risk-medium);
        }

        .risk-high .risk-text {
            color: var(--risk-high);
        }

        .risk-precautions {
            margin-top: 1.5rem;
        }

        .risk-precautions h4 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .risk-precautions ul {
            list-style-type: none;
            padding-left: 0;
        }

        .risk-precautions li {
            margin-bottom: 0.8rem;
            padding-left: 1.5rem;
            position: relative;
            line-height: 1.6;
        }

        .risk-precautions li::before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .risk-actions {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
        }

        .chart-container {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            height: 450px;
            position: relative;
        }

        /* Period Tracker Styles */
        .tracker-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid #e1e8ed;
        }

        .tracker-tab {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--light-text);
            cursor: pointer;
            position: relative;
            transition: var(--transition);
        }

        .tracker-tab.active {
            color: var(--primary-color);
        }

        .tracker-tab::after {
            content: "";
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: var(--transition);
        }

        .tracker-tab.active::after {
            transform: scaleX(1);
        }

        .tracker-content {
            display: none;
        }

        .tracker-content.active {
            display: block;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--gradient-secondary);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--light-text);
        }

        .prediction-card {
            background: var(--gradient-luxury-light);
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
        }

        .prediction-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .prediction-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            gap: 1rem;
        }

        .prediction-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
            min-width: 30px;
        }

        .prediction-text {
            font-size: 1.1rem;
        }

            /* Floating Chatbot Button */
    .chatbot-fab {
        position: fixed;
        bottom: 32px;
        right: 32px;
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: var(--gradient-primary);
        color: #fff;
        border: none;
        box-shadow: 0 8px 24px rgba(142,68,173,0.18);
        font-size: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 999;
        transition: box-shadow 0.3s, transform 0.3s;
    }
    .chatbot-fab:hover {
        box-shadow: 0 12px 32px rgba(142,68,173,0.28);
        transform: scale(1.08);
    }

        .period-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .symptom-input {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .symptom-tag {
            background: var(--secondary-color);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .symptom-tag button {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 1rem;
        }

        .period-list {
            margin-top: 2rem;
        }

        .period-item {
            background: var(--gradient-secondary);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .period-info h4 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .period-details {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .period-symptoms {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .period-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .icon-btn:hover {
            transform: scale(1.2);
        }

        .icon-btn.delete {
            color: var(--error-color);
        }

        .cycle-chart-container {
            margin-top: 2rem;
            height: 400px;
        }

        /* Chatbot Styles */
        .chat-container {
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            background: var(--chatbot-bg);
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
        }

        .message {
            display: flex;
            margin-bottom: 1.5rem;
            align-items: flex-start;
            gap: 1rem;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 1.2rem;
            border-radius: var(--border-radius);
            background-color: var(--white);
            font-size: 1rem;
            line-height: 1.6;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .message.user .message-content {
            background: var(--chatbot-user-bg);
            color: var(--chatbot-user-text);
        }

        .message-avatar {
            font-size: 2.5rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: var(--white);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .message.user .message-avatar {
            background: var(--gradient-accent);
        }

        .message-content h3 {
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            color: var(--primary-color);
        }

        .message-content ul, .message-content ol {
            margin: 0.8rem 0;
            padding-left: 1.5rem;
        }

        .message-content li {
            margin-bottom: 0.5rem;
        }

        .message-content strong {
            color: var(--primary-color);
            font-weight: 600;
        }

        .message-content .emoji {
            font-size: 1.2rem;
            margin-right: 0.3rem;
        }

        .chat-input-container {
            display: flex;
            gap: 1rem;
        }

        .chat-input {
            flex: 1;
            padding: 1rem;
            border: 1px solid #e1e8ed;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        /* Doctor Contact Styles */
        .doctor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
        }

        .doctor-card {
            background: var(--gradient-secondary);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            transition: var(--transition);
        }

        .doctor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .doctor-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        .doctor-specialty {
            color: var(--light-text);
            margin-bottom: 1.5rem;
            font-size: 1rem;
        }

        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-size: 1rem;
        }

        .contact-link {
            color: var(--primary-color);
            text-decoration: none;
        }

        .contact-link:hover {
            text-decoration: underline;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .main-feature-content {
                flex-direction: column;
            }
            
            .landing-hero h1 {
                font-size: 3rem;
            }
            
            .risk-content {
                grid-template-columns: 1fr;
            }
            
            .wizard-content {
                padding: 2rem;
            }
            
            .step-indicators {
                gap: 1rem;
                padding: 1.5rem;
            }
            
            .step-label {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1.5rem;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
            }

            .message-content {
                max-width: 85%;
            }

            .doctor-grid {
                grid-template-columns: 1fr;
            }

            .landing-hero h1 {
                font-size: 2.5rem;
            }
            
            .landing-hero p {
                font-size: 1.1rem;
            }
            
            .pcos-info {
                padding: 2rem;
            }
            
            .main-feature {
                padding: 2rem;
            }
            
            .chart-container {
                height: 350px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .wizard-actions {
                flex-direction: column;
                gap: 1rem;
            }
            
            .btn-prev, .btn-next, .btn-submit {
                width: 100%;
                justify-content: center;
            }
            
            .risk-header {
                padding: 2rem;
            }
            
            .risk-score {
                font-size: 3rem;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--gradient-primary);
            color: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
            z-index: 1000;
            font-size: 1rem;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Floating animation for decorative elements */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        /* User dropdown styles */
        .user-menu { position: relative; display: flex; align-items: center; gap: 0.5rem; }
        .user-dropdown { position: relative; }
        .dropdown-toggle {
            display: inline-flex; align-items: center; gap: 0.4rem;
            background: transparent; border: 1px solid var(--primary-color);
            color: var(--primary-color); padding: 0.45rem 0.75rem; border-radius: 10px; cursor: pointer;
        }
        .dropdown-toggle i { font-size: 0.9rem; }
        .dropdown-menu {
            position: absolute; right: 0; top: 120%;
            background: var(--white); border: 1px solid #eee; border-radius: 10px;
            box-shadow: 0 12px 24px rgba(0,0,0,0.08); padding: 0.4rem; display: none; min-width: 180px;
            z-index: 9999;
        }
        .dropdown-menu.open { display: block; }
        .dropdown-item { width: 100%; text-align: left; background: transparent; border: 0; padding: 0.6rem 0.75rem; border-radius: 8px; cursor: pointer; color: var(--text-color); }
        .dropdown-item:hover { background: #faf5ff; color: var(--primary-color); }

        /* Auth page CTAs */
        .signup-cta-text { margin-top: 0.8rem; text-align: center; color: var(--primary-color); font-weight: 600; }
        .signup-cta-text a { color: var(--primary-color); text-decoration: underline; }
        .forgot-cta-text { margin-top: 0.6rem; text-align: center; color: var(--light-text); font-size: 0.95rem; }
        .forgot-cta-text a { color: var(--primary-color); text-decoration: underline; }

        /* Fitness Tracker â€“ layout polish */
        #fitness .fitness-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 1rem 1.25rem;
        }
        @media (max-width: 980px) {
            #fitness .fitness-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
        @media (max-width: 640px) {
            #fitness .fitness-grid { grid-template-columns: 1fr; }
        }
        #fitness .form-group {
            background: #faf7fd;
            border: 1px solid #efe7f7;
            border-radius: 12px;
            padding: 12px;
        }
        #fitness .form-group label { color: #6c3483; font-weight: 600; margin-bottom: 6px; display: block; }
        #fitness .form-control, #fitness select, #fitness textarea {
            background: #fff;
            border: 1px solid #e9d9f5;
            border-radius: 10px;
            padding: 10px 12px;
            outline: none;
            width: 100%;
        }
        #fitness .form-control:focus, #fitness select:focus, #fitness textarea:focus {
            border-color: #c6a3e6;
            box-shadow: 0 0 0 3px rgba(142,68,173,0.08);
        }
        #fitness .form-divider {
            grid-column: 1 / -1;
            display: flex; align-items: center; gap: 10px;
            margin-top: 0.25rem; margin-bottom: 0.25rem;
        }
        #fitness .form-divider .title {
            color: #6c3483; font-weight: 800; letter-spacing: 0.2px;
            white-space: nowrap;
        }
        #fitness .form-divider .rule { flex: 1; height: 1px; background: linear-gradient(90deg, #e8dcf5, transparent); }
        #fitness .symptom-input { display: flex; flex-wrap: wrap; gap: 8px; }
        #fitness .symptom-input label {
            background: #fff;
            border: 1px solid #e9d9f5; border-radius: 999px; padding: 8px 12px;
            display: inline-flex; align-items: center; gap: 8px; cursor: pointer; color: #5a4b67;
        }
        #fitness .symptom-input input { accent-color: #8e44ad; }
        #fitness .mini-btn {
            display: inline-flex; align-items: center; gap: 6px;
            border: 1px solid #e0d6ee; color: #6c3483; background: #fff;
            padding: 6px 10px; border-radius: 20px; font-size: 0.85rem; cursor: pointer;
        }
        #fitness .mini-btn:hover { background: #f8f2ff; }
        #fitness .field-actions { margin-top: 0.4rem; }
        #fitness .prediction-card { border: 1px solid #efe7f7; }
        /* Center the date card in the fitness grid */
        #fitness .form-group--date { grid-column: 2; justify-self: center; max-width: 420px; width: 100%; }
        @media (max-width: 980px) {
            #fitness .form-group--date { grid-column: 1 / -1; justify-self: stretch; max-width: none; }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-card">
            <div class="login-logo">
                <span>ðŸŒ¸</span>
                <span>OvaCare</span>
            </div>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <button type="submit" class="btn">Login</button>
                <div class="login-error" id="loginError">Invalid username or password</div>
            </form>
            
            <div id="signupCta" class="signup-cta-text">
                <span>No account? <a href="#" id="showSignupLink">Create one!</a></span>
            </div>

            <div id="forgotCtaRow" class="forgot-cta-text">
                <span>Forgot password? <a href="#" id="forgotPasswordLink">Reset Password</a></span>
            </div>

            <form class="login-form" id="signupForm" style="margin-top:2rem; display:none;">
                <h3 style="color:#8e44ad;">Sign Up</h3>
                <div class="form-group">
                    <label for="signupUsername">Username</label>
                    <input type="text" class="form-control" id="signupUsername" required>
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" class="form-control" id="signupEmail" required>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" class="form-control" id="signupPassword" required>
                </div>
                <button type="submit" class="btn btn-secondary">Sign Up</button>
                <div class="login-error" id="signupError">Signup failed</div>
                <div style="margin-top:0.8rem;">
                    <button id="showLoginLink" type="button" class="btn btn-secondary" style="width:100%;">Already have an account? Back to sign in</button>
                </div>
            </form>

            <!-- Email Verification Form -->
            <form class="login-form" id="verifyForm" style="margin-top:2rem; display:none;">
                <h3 style="color:#8e44ad;">Verify your email</h3>
                <p style="color:#6c3483; font-size:0.95rem; margin-top:0.25rem;">We sent a 6-digit code to your email. Enter it below to complete signup.</p>
                <div class="form-group">
                    <label for="verifyEmail">Email</label>
                    <input type="email" class="form-control" id="verifyEmail" required>
                </div>
                <div class="form-group">
                    <label for="verifyCode">Verification Code</label>
                    <input type="text" class="form-control" id="verifyCode" maxlength="10" required>
                </div>
                <button type="submit" class="btn">Verify</button>
                <div class="login-error" id="verifyError">Verification failed</div>
                <div class="forgot-cta-text" style="margin-top:0.8rem;">
                    <span>Didn't get a code? <a href="#" id="resendCodeLink">Resend</a></span>
                </div>
                <div style="margin-top:0.8rem;">
                    <button id="backToLoginFromVerify" type="button" class="btn btn-secondary" style="width:100%;">Back to sign in</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App (hidden initially) -->
    <div class="app-container" id="appContainer">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <span>ðŸŒ¸</span>
                        <span>OvaCare</span>
                    </div>
                    <nav>
                        <ul>
                            <li><button class="nav-btn active" data-section="landing">Home</button></li>
                            <li><button class="nav-btn" data-section="prediction">Risk Prediction</button></li>
                            <li><button class="nav-btn" data-section="tracker">Period Tracker</button></li>
                            <li><button class="nav-btn" data-section="fitness">Daily Fitness Tracker</button></li>
                            <li><button class="nav-btn" data-section="doctors">Doctor Contact</button></li>
                        </ul>
                    </nav>
                    <div class="user-menu">
                        <div class="user-dropdown">
                            <button id="userDropdownToggle" class="dropdown-toggle">
                                <span class="user-name" id="userName">Welcome</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="dropdown-menu" id="userDropdownMenu">
                                <button id="changePasswordBtn" class="dropdown-item">Change Password</button>
                                <button id="logoutBtn" class="dropdown-item">Logout</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <div class="container">
                <!-- Landing Page Section -->
                <section id="landing" class="section active">
                    <div class="landing-hero">
                        <h1>Welcome to OvaCare</h1>
                        <p>Your comprehensive resource for PCOS information, risk assessment, period tracking, and finding trusted healthcare providers.</p>
                    </div>
                    
                    <div class="main-feature">
                        <div class="main-feature-content">
                            <div class="main-feature-text">`
                                <h2 class="main-feature-title">Advanced PCOS Risk Prediction</h2>
                                <p class="main-feature-description">Our state-of-the-art prediction tool analyzes over 25 health and lifestyle factors to provide you with a personalized PCOS risk assessment. Take control of your health journey with insights tailored specifically to you.</p>
                                <a href="#" class="main-feature-cta" data-feature="prediction">Try Risk Assessment</a>
                            </div>
                            <div class="main-feature-image">
                                <img src="https://cdn.prod.website-files.com/65b16f0ee351dc8f2068f512/65f70305ffeca9001ef0eed3_dyk1%201.webp" alt="PCOS Risk Assessment">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Secondary Features -->
                    <div class="secondary-features">
                        <div class="secondary-feature" data-feature="tracker">
                            <div class="secondary-feature-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="secondary-feature-content">
                                <h3>Period Tracker</h3>
                                <p>Monitor your menstrual cycle and predict future periods with ease.</p>
                            </div>
                        </div>
                        <div class="secondary-feature" data-feature="chatbot">
                            <div class="secondary-feature-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="secondary-feature-content">
                                <h3>PCOS Chatbot</h3>
                                <p>Get instant answers to your PCOS questions from our AI assistant.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pcos-info">
                        <h2>Understanding PCOS</h2>
                        <p><strong>Polycystic Ovary Syndrome (PCOS)</strong> is a common hormonal disorder affecting women of reproductive age. It is characterized by irregular menstrual periods, excess androgen levels, and polycystic ovaries. PCOS affects approximately 1 in 10 women worldwide and can have significant impacts on fertility, metabolism, and overall health.</p>
                        <p>Women with PCOS may experience a range of symptoms that can vary in severity. Early diagnosis and management are crucial for preventing long-term complications such as type 2 diabetes, heart disease, and endometrial cancer.</p>
                        
                        <h3>Common Symptoms of PCOS</h3>
                        <div class="pcos-symptoms">
                            <div class="symptom-card">
                                <span class="symptom-icon">
                                    <i class="fas fa-calendar-times"></i>
                                </span>
                                <span>Irregular or absent menstrual periods</span>
                            </div>
                            <div class="symptom-card">
                                <span class="symptom-icon">
                                    <i class="fas fa-user"></i>
                                </span>
                                <span>Excess hair growth (hirsutism)</span>
                            </div>
                            <div class="symptom-card">
                                <span class="symptom-icon">
                                    <i class="fas fa-face-frown"></i>
                                </span>
                                <span>Acne and oily skin</span>
                            </div>
                            <div class="symptom-card">
                                <span class="symptom-icon">
                                    <i class="fas fa-weight"></i>
                                </span>
                                <span>Weight gain or difficulty losing weight</span>
                            </div>
                            <div class="symptom-card">
                                <span class="symptom-icon">
                                    <i class="fas fa-cut"></i>
                                </span>
                                <span>Thinning hair or male-pattern baldness</span>
                            </div>
                            <div class="symptom-card">
                                <span class="symptom-icon">
                                    <i class="fas fa-dna"></i>
                                </span>
                                <span>Insulin resistance</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Enhanced PCOS Risk Prediction Section -->
                <section id="prediction" class="section">
                    <div class="prediction-wizard">
                        <div class="wizard-header">
                            <h2>PCOS Risk Assessment</h2>
                            <p>Complete our comprehensive evaluation to understand your PCOS risk profile</p>
                            <div class="progress-container">
                                <div class="progress-bar" id="progressBar" style="width: 25%"></div>
                            </div>
                        </div>
                        
                        <div class="step-indicators">
                            <div class="step-indicator active" data-step="1">
                                <div class="step-circle">1</div>
                                <div class="step-label">Basic Info</div>
                            </div>
                            <div class="step-indicator" data-step="2">
                                <div class="step-circle">2</div>
                                <div class="step-label">Medical History</div>
                            </div>
                            <div class="step-indicator" data-step="3">
                                <div class="step-circle">3</div>
                                <div class="step-label">Lifestyle</div>
                            </div>
                            <div class="step-indicator" data-step="4">
                                <div class="step-circle">4</div>
                                <div class="step-label">Review</div>
                            </div>
                        </div>
                        
                        <div class="wizard-content">
                            <!-- Step 1: Basic Information -->
                            <div class="step-content active" id="step1">
                                <h3 class="step-title">
                                    <span class="step-icon">ðŸ‘¤</span>
                                    Basic Information
                                </h3>
                                <p class="step-description">Let's start with some basic information about you</p>
                                
                                <div class="form-section">
                                    <h4 class="form-section-title">
                                        <i class="fas fa-user-circle"></i>
                                        Personal Details
                                    </h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="age">Age <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="age" min="15" max="50" required>
                                            <span class="error-message">Please enter a valid age between 15 and 50</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="height">Height (cm) <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="height" min="100" max="250" step="0.1" required>
                                            <span class="error-message">Please enter a valid height between 100 and 250 cm</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="weight">Weight (kg) <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="weight" min="30" max="200" step="0.1" required>
                                            <span class="error-message">Please enter a valid weight between 30 and 200 kg</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="bmi">BMI <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="bmi" min="10" max="50" step="0.1" required>
                                            <span class="error-message">Please enter a valid BMI between 10 and 50</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4 class="form-section-title">
                                        <i class="fas fa-tint"></i>
                                        Health Information
                                    </h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="blood_group">Blood Group <span class="required">*</span></label>
                                            <select class="form-control" id="blood_group" required>
                                                <option value="">Select blood group</option>
                                                <option value="A+">A+</option>
                                                <option value="A-">A-</option>
                                                <option value="B+">B+</option>
                                                <option value="B-">B-</option>
                                                <option value="AB+">AB+</option>
                                                <option value="AB-">AB-</option>
                                                <option value="O+">O+</option>
                                                <option value="O-">O-</option>
                                            </select>
                                            <span class="error-message">Please select your blood group</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="skin_type">Skin Type <span class="required">*</span></label>
                                            <select class="form-control" id="skin_type" required>
                                                <option value="">Select skin type</option>
                                                <option value="Oily">Oily</option>
                                                <option value="Dry">Dry</option>
                                                <option value="Normal">Normal</option>
                                                <option value="Combination">Combination</option>
                                                <option value="Sensitive">Sensitive</option>
                                            </select>
                                            <span class="error-message">Please select your skin type</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Step 2: Medical History -->
                            <div class="step-content" id="step2">
                                <h3 class="step-title">
                                    <span class="step-icon">ðŸ¥</span>
                                    Medical History
                                </h3>
                                <p class="step-description">Tell us about your medical and reproductive history</p>
                                
                                <div class="form-section">
                                    <h4 class="form-section-title">
                                        <i class="fas fa-calendar-alt"></i>
                                        Menstrual History
                                    </h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="cycle_length">Cycle Length (days) <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="cycle_length" min="15" max="50" required>
                                            <span class="error-message">Please enter cycle length between 15 and 50 days</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="cycle_reg">Cycle Regularity <span class="required">*</span></label>
                                            <select class="form-control" id="cycle_reg" required>
                                                <option value="">Select regularity</option>
                                                <option value="Y">Regular</option>
                                                <option value="N">Irregular</option>
                                            </select>
                                            <span class="error-message">Please select cycle regularity</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4 class="form-section-title">
                                        <i class="fas fa-heart"></i>
                                        Reproductive History
                                    </h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="marriage_years">Marriage Status (Years) <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="marriage_years" min="0" max="50" required>
                                            <span class="error-message">Please enter marriage duration between 0 and 50 years</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="pregnant">Currently Pregnant <span class="required">*</span></label>
                                            <select class="form-control" id="pregnant" required>
                                                <option value="">Select option</option>
                                                <option value="Y">Yes</option>
                                                <option value="N">No</option>
                                            </select>
                                            <span class="error-message">Please select pregnancy status</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="abortions">Number of Abortions <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="abortions" min="0" max="10" required>
                                            <span class="error-message">Please enter number of abortions between 0 and 10</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4 class="form-section-title">
                                        <i class="fas fa-pills"></i>
                                        Medications
                                    </h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="birth_control">Birth Control <span class="required">*</span></label>
                                            <select class="form-control" id="birth_control" required>
                                                <option value="">Select option</option>
                                                <option value="Y">Yes</option>
                                                <option value="N">No</option>
                                            </select>
                                            <span class="error-message">Please select birth control status</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="regular_med">Regular Medication <span class="required">*</span></label>
                                            <select class="form-control" id="regular_med" required>
                                                <option value="">Select option</option>
                                                <option value="Y">Yes</option>
                                                <option value="N">No</option>
                                            </select>
                                            <span class="error-message">Please select medication status</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Step 3: Lifestyle & Habits -->
                            <div class="step-content" id="step3">
                                <h3 class="step-title">
                                    <span class="step-icon">ðŸŒ¿</span>
                                    Lifestyle & Habits
                                </h3>
                                <p class="step-description">Help us understand your lifestyle and daily habits</p>
                                
                                <div class="form-section">
                                    <h4 class="form-section-title">
                                        <i class="fas fa-running"></i>
                                        Physical Activity
                                    </h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="exercise">Exercise (days/week) <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="exercise" min="0" max="7" required>
                                            <span class="error-message">Please enter exercise frequency between 0 and 7 days</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="sleep">Sleep (hours/day) <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="sleep" min="0" max="24" step="0.5" required>
                                            <span class="error-message">Please enter sleep duration between 0 and 24 hours</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4 class="form-section-title">
                                        <i class="fas fa-utensils"></i>
                                        Diet & Nutrition
                                    </h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="water">Water Intake (liters/day) <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="water" min="0" max="10" step="0.1" required>
                                            <span class="error-message">Please enter water intake between 0 and 10 liters</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="fast_food">Fast Food (meals/week) <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="fast_food" min="0" max="21" required>
                                            <span class="error-message">Please enter fast food frequency between 0 and 21 meals</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="coffee">Coffee/Tea (cups/day) <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="coffee" min="0" max="10" required>
                                            <span class="error-message">Please enter coffee/tea intake between 0 and 10 cups</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4 class="form-section-title">
                                        <i class="fas fa-smoking"></i>
                                        Habits & Stress
                                    </h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="smoking">Smoking <span class="required">*</span></label>
                                            <select class="form-control" id="smoking" required>
                                                <option value="">Select option</option>
                                                <option value="Y">Yes</option>
                                                <option value="N">No</option>
                                            </select>
                                            <span class="error-message">Please select smoking status</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="alcohol">Alcohol (drinks/week) <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="alcohol" min="0" max="50" required>
                                            <span class="error-message">Please enter alcohol consumption between 0 and 50 drinks</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="stress">Stress Level (1-10) <span class="required">*</span></label>
                                            <input type="number" class="form-control" id="stress" min="1" max="10" required>
                                            <span class="error-message">Please enter stress level between 1 and 10</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Step 4: Review & Symptoms -->
                            <div class="step-content" id="step4">
                                <h3 class="step-title">
                                    <span class="step-icon">ðŸ“‹</span>
                                    Review & Symptoms
                                </h3>
                                <p class="step-description">Review your information and tell us about any symptoms</p>
                                
                                <div class="step-summary">
                                    <h4 class="summary-title">Your Information Summary</h4>
                                    <div class="summary-grid" id="summaryGrid">
                                        <!-- Summary will be populated dynamically -->
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4 class="form-section-title">
                                        <i class="fas fa-notes-medical"></i>
                                        Symptoms
                                    </h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="hair_loss">Hair Loss <span class="required">*</span></label>
                                            <select class="form-control" id="hair_loss" required>
                                                <option value="">Select option</option>
                                                <option value="Y">Yes</option>
                                                <option value="N">No</option>
                                            </select>
                                            <span class="error-message">Please select hair loss status</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="pimples">Pimples/Acne <span class="required">*</span></label>
                                            <select class="form-control" id="pimples" required>
                                                <option value="">Select option</option>
                                                <option value="Y">Yes</option>
                                                <option value="N">No</option>
                                            </select>
                                            <span class="error-message">Please select acne status</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="excess_hair">Excess Hair Growth <span class="required">*</span></label>
                                            <select class="form-control" id="excess_hair" required>
                                                <option value="">Select option</option>
                                                <option value="Y">Yes</option>
                                                <option value="N">No</option>
                                            </select>
                                            <span class="error-message">Please select excess hair status</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="weight_loss_diff">Difficulty in Weight Loss <span class="required">*</span></label>
                                            <select class="form-control" id="weight_loss_diff" required>
                                                <option value="">Select option</option>
                                                <option value="Y">Yes</option>
                                                <option value="N">No</option>
                                            </select>
                                            <span class="error-message">Please select weight loss difficulty</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="skin_darkening">Skin Darkening <span class="required">*</span></label>
                                            <select class="form-control" id="skin_darkening" required>
                                                <option value="">Select option</option>
                                                <option value="Y">Yes</option>
                                                <option value="N">No</option>
                                            </select>
                                            <span class="error-message">Please select skin darkening status</span>
                                        </div>
                                        <div class="form-group">
                                            <label for="fam_hist">Family History of Hormonal Issues <span class="required">*</span></label>
                                            <select class="form-control" id="fam_hist" required>
                                                <option value="">Select option</option>
                                                <option value="Y">Yes</option>
                                                <option value="N">No</option>
                                            </select>
                                            <span class="error-message">Please select family history</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="wizard-actions">
                            <button class="btn-prev" id="prevBtn" style="display: none;">
                                <i class="fas fa-arrow-left"></i>
                                Previous
                            </button>
                            <button class="btn-next" id="nextBtn">
                                Next
                                <i class="fas fa-arrow-right"></i>
                            </button>
                            <button class="btn-submit" id="submitBtn" style="display: none;">
                                <i class="fas fa-calculator"></i>
                                Calculate Risk
                            </button>
                        </div>
                    </div>
                    
                    <!-- Risk Results Section -->
                    <div class="risk-result" id="riskResult">
                        <div class="risk-header">
                            <h3>Your PCOS Risk Assessment</h3>
                            <div class="risk-score" id="riskScore">0%</div>
                            <div class="risk-label" id="riskLabel">Calculating...</div>
                            <div class="risk-bar-container">
                                <div class="risk-bar">
                                    <div class="risk-fill" id="riskFill" style="width: 0%"></div>
                                    <div class="risk-percentage" id="riskPercentage">0%</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="risk-content">
                            <div class="risk-info" id="riskInfo">
                                <h3>Risk Level & Recommendations</h3>
                                <div class="risk-level" id="riskLevel">
                                    <div class="risk-indicator"></div>
                                    <div class="risk-text">Low Risk</div>
                                </div>
                                <div class="risk-precautions" id="riskPrecautions">
                                    <h4>Recommended Actions</h4>
                                    <ul id="precautionsList">
                                        <!-- Precautions will be populated based on risk level -->
                                    </ul>
                                </div>
                                <div class="risk-actions">
                                    <button class="btn btn-cta" id="contactDoctorBtn">
                                        <i class="fas fa-user-md"></i>
                                        Connect to a Doctor
                                    </button>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="riskChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Period Tracker Section -->
                <section id="tracker" class="section">
                    <div class="card">
                        <h2>Period Tracker</h2>
                        
                        <div class="tracker-tabs">
                            <button class="tracker-tab active" data-tab="dashboard">Dashboard</button>
                            <button class="tracker-tab" data-tab="add-period">Add Period</button>
                            <button class="tracker-tab" data-tab="history">History</button>
                        </div>
                        
                        <!-- Dashboard Tab -->
                        <div class="tracker-content active" id="dashboard">
                            <div class="dashboard-stats">
                                <div class="stat-card">
                                    <div class="stat-value" id="avgCycleLength">--</div>
                                    <div class="stat-label">Average Cycle Length</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="avgPeriodDuration">--</div>
                                    <div class="stat-label">Average Period Duration</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="lastPeriodStart">--</div>
                                    <div class="stat-label">Last Period Start</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="cycleRegularity">--</div>
                                    <div class="stat-label">Cycle Regularity</div>
                                </div>
                            </div>
                            
                            <div class="prediction-card">
                                <h3 class="prediction-title">Predictions</h3>
                                <div class="prediction-item">
                                    <div class="prediction-icon">
                                        <i class="fas fa-calendar-day"></i>
                                    </div>
                                    <div class="prediction-text">
                                        Next Period Estimated Start: <strong id="nextPeriodDate">--</strong>
                                    </div>
                                </div>
                                <div class="prediction-item">
                                    <div class="prediction-icon">
                                        <i class="fas fa-calendar-week"></i>
                                    </div>
                                    <div class="prediction-text">
                                        Likely Range: <strong id="periodRange">--</strong>
                                    </div>
                                </div>
                                <div class="prediction-item">
                                    <div class="prediction-icon">
                                        <i class="fas fa-baby"></i>
                                    </div>
                                    <div class="prediction-text">
                                        Estimated Fertile Window: <strong id="fertileWindow">--</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Add Period Tab -->
                        <div class="tracker-content" id="add-period">
                            <form id="periodForm">
                                <div class="period-form">
                                    <div class="form-group">
                                        <label for="periodStartDate">Start Date</label>
                                        <input type="date" class="form-control" id="periodStartDate" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="periodEndDate">End Date</label>
                                        <input type="date" class="form-control" id="periodEndDate" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Symptoms</label>
                                    <div class="symptom-input" id="symptomInput">
                                        <input type="text" class="form-control" id="symptomText" placeholder="Enter a symptom and press Add">
                                        <button type="button" class="btn btn-secondary" id="addSymptomBtn">Add</button>
                                    </div>
                                    <div id="symptomTags" class="symptom-input"></div>
                                </div>
                                <button type="submit" class="btn">Save Period</button>
                            </form>
                        </div>
                        
                        <!-- History Tab -->
                        <div class="tracker-content" id="history">
                            <div class="period-list" id="periodList">
                                <!-- Period items will be populated here -->
                            </div>
                        </div>
                        
                        
                    </div>
                </section>

                <!-- PCOS Chatbot Section -->
                <section id="chatbot" class="section">
                    <div class="card">
                        <h2>PCOS Chatbot</h2>
                        <div class="chat-container">
                            <div class="chat-messages" id="chatMessages">
                                <div class="message">
                                    <div class="message-avatar">ðŸ‘©â€âš•ï¸</div>
                                    <div class="message-content">
                                        <h3>Hello! ðŸ‘‹ I'm your PCOS assistant. How can I help you today?</h3>
                                        <p>I'm here to provide information and support for all your PCOS-related questions. Whether you're looking for advice on symptoms, treatment options, or lifestyle changes, I'm here to help!</p>
                                        <p>Feel free to ask me anything about:</p>
                                        <ul>
                                            <li>ðŸ©º PCOS symptoms and diagnosis</li>
                                            <li>ðŸ¥— Diet and nutrition recommendations</li>
                                            <li>ðŸ’Š Exercise and lifestyle tips</li>
                                            <li>ðŸ§ª Treatment options</li>
                                            <li>ðŸ“Š Risk assessment</li>
                                            <li>ðŸ‘©â€âš•ï¸ When to see a doctor</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="chat-input-container">
                                <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything about PCOS...">
                                <button class="btn" id="sendBtn">Send</button>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- Fitness Tracker Section -->
                <section id="fitness" class="section">
                    <div class="card">
                        <h2>Daily Fitness & Wellbeing</h2>
                        <form id="fitnessForm">
                            <div class="form-grid fitness-grid">
                                <div class="form-group form-group--date">
                                    <label for="fitnessDate">Date</label>
                                    <input type="date" id="fitnessDate" class="form-control" required>
                                    <div class="field-actions"><button type="button" class="mini-btn" id="todayDateBtn">Today</button></div>
                                </div>

                                <div class="form-divider"><span class="title">Activity</span><span class="rule"></span></div>
                                <div class="form-group">
                                    <label for="stepsInput">Steps</label>
                                    <input type="number" id="stepsInput" class="form-control" min="0" placeholder="e.g., 6000">
                                </div>
                                <div class="form-group">
                                    <label for="exerciseInput">Exercise (minutes)</label>
                                    <input type="number" id="exerciseInput" class="form-control" min="0" placeholder="e.g., 30">
                                </div>
                                <div class="form-group">
                                    <label for="weightInput">Weight (kg)</label>
                                    <input type="number" id="weightInput" class="form-control" min="0" step="0.1" placeholder="e.g., 68.2">
                                </div>

                                <div class="form-divider"><span class="title">Hydration & Sleep</span><span class="rule"></span></div>
                                <div class="form-group">
                                    <label for="waterInput">Water (liters)</label>
                                    <input type="number" id="waterInput" class="form-control" min="0" step="0.1" placeholder="e.g., 2.0">
                                </div>
                                <div class="form-group">
                                    <label for="sleepInput">Sleep (hours)</label>
                                    <input type="number" id="sleepInput" class="form-control" min="0" step="0.1" placeholder="e.g., 7.5">
                                </div>
                                <div class="form-group">
                                    <label for="stressInput">Stress Level (1-10)</label>
                                    <input type="number" id="stressInput" class="form-control" min="1" max="10" placeholder="e.g., 5">
                                </div>

                                <div class="form-divider"><span class="title">Menstruation & Mood</span><span class="rule"></span></div>
                                <div class="form-group">
                                    <label for="flowSelect">Flow Level</label>
                                    <select id="flowSelect" class="form-control">
                                        <option value="">None</option>
                                        <option value="light">Light</option>
                                        <option value="moderate">Moderate</option>
                                        <option value="heavy">Heavy</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="painInput">Pain Level (0-10)</label>
                                    <input type="number" id="painInput" class="form-control" min="0" max="10" placeholder="e.g., 3">
                                </div>
                                <div class="form-group">
                                    <label for="moodSelect">Mood</label>
                                    <select id="moodSelect" class="form-control">
                                        <option value="">-- Select --</option>
                                        <option value="calm">Calm</option>
                                        <option value="energetic">Energetic</option>
                                        <option value="anxious">Anxious</option>
                                        <option value="moody">Moody</option>
                                        <option value="low">Low</option>
                                    </select>
                                </div>

                                <div class="form-divider"><span class="title">Symptoms</span><span class="rule"></span></div>
                                <div class="form-group" style="grid-column: 1 / -1;">
                                    <label>Symptoms</label>
                                    <div class="symptom-input" style="margin-top:0.25rem;">
                                        <label><input type="checkbox" id="crampsChk"> Cramps</label>
                                        <label><input type="checkbox" id="acneChk"> Acne</label>
                                        <label><input type="checkbox" id="bloatingChk"> Bloating</label>
                                        <label><input type="checkbox" id="headachesChk"> Headaches</label>
                                        <label><input type="checkbox" id="cravingsChk"> Cravings</label>
                                        <label><input type="checkbox" id="fatigueChk"> Fatigue</label>
                                    </div>
                                </div>

                                <div class="form-divider"><span class="title">Medications & Notes</span><span class="rule"></span></div>
                                <div class="form-group" style="grid-column: 1 / -1;">
                                    <label for="medicationsInput">Medications / Supplements (comma-separated)</label>
                                    <input type="text" id="medicationsInput" class="form-control" placeholder="e.g., Metformin, Inositol">
                                </div>
                                <div class="form-group" style="grid-column: 1 / -1;">
                                    <label for="notesInput">Notes</label>
                                    <textarea id="notesInput" class="form-control" rows="3" placeholder="Anything notable today..."></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn" style="margin-top:0.5rem;">Save Day</button>
                        </form>
                        <div id="fitnessSummary" class="prediction-card" style="margin-top:1rem;"></div>
                        <div id="aiSuggestionBox" class="prediction-card" style="margin-top:1rem;"></div>
                        <div class="period-list" id="fitnessHistory" style="margin-top:1rem;"></div>
                    </div>
                </section>
                <!-- Doctor Contact Section -->
                <section id="doctors" class="section">
                    <div class="card">
                        <h2>Trusted Healthcare Providers</h2>
                        <div class="doctor-grid" id="doctorGrid">
                            <!-- Doctor cards will be populated by JavaScript -->
                        </div>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <div class="toast" id="toast"></div>
    
    <!-- Change Password Modal -->
    <div id="changePasswordModal" style="display:none; position: fixed; inset:0; background: rgba(0,0,0,0.4); z-index: 2000; align-items:center; justify-content:center;">
        <div style="background:#fff; padding:1.5rem; border-radius:12px; width:90%; max-width:420px; box-shadow:0 10px 30px rgba(0,0,0,0.15);">
            <h3 style="margin-top:0; color:#8e44ad;">Change Password</h3>
            <form id="changePasswordForm" class="login-form" style="margin-top:0.5rem;">
                <div class="form-group">
                    <label for="oldPassword">Current Password</label>
                    <input type="password" class="form-control" id="oldPassword" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <input type="password" class="form-control" id="newPassword" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password</label>
                    <input type="password" class="form-control" id="confirmPassword" required>
                </div>
                <div id="changePwdError" class="login-error">Error</div>
                <div style="display:flex; gap:0.75rem; margin-top:1rem;">
                    <button type="button" id="cancelChangePwd" class="btn btn-secondary" style="flex:1;">Cancel</button>
                    <button type="submit" class="btn" style="flex:1;">Update</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Forgot Password Modal (UI only for now) -->
    <div id="forgotPasswordModal" style="display:none; position: fixed; inset:0; background: rgba(0,0,0,0.4); z-index: 2000; align-items:center; justify-content:center;">
        <div style="background:#fff; padding:1.5rem; border-radius:12px; width:90%; max-width:420px; box-shadow:0 10px 30px rgba(0,0,0,0.15);">
            <h3 style="margin-top:0; color:#8e44ad;">Reset Password</h3>
            <p style="margin-top:0.25rem; color:#6c3483;">Enter your account email to request a reset link.</p>
            <form id="forgotPasswordForm" class="login-form" style="margin-top:0.5rem;">
                <div class="form-group">
                    <label for="resetEmail">Email</label>
                    <input type="email" class="form-control" id="resetEmail" required>
                </div>
                <div id="forgotPwdError" class="login-error">Error</div>
                <div style="display:flex; gap:0.75rem; margin-top:1rem;">
                    <button type="button" id="cancelForgotPwd" class="btn btn-secondary" style="flex:1;">Cancel</button>
                    <button type="submit" class="btn" style="flex:1;">Send</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Reset Confirm Modal -->
    <div id="resetConfirmModal" style="display:none; position: fixed; inset:0; background: rgba(0,0,0,0.4); z-index: 2000; align-items:center; justify-content:center;">
        <div style="background:#fff; padding:1.5rem; border-radius:12px; width:90%; max-width:420px; box-shadow:0 10px 30px rgba(0,0,0,0.15);">
            <h3 style="margin-top:0; color:#8e44ad;">Enter Reset Code</h3>
            <p style="margin-top:0.25rem; color:#6c3483;">Check your email for a 6-digit code, then set a new password.</p>
            <form id="resetConfirmForm" class="login-form" style="margin-top:0.5rem;">
                <div class="form-group">
                    <label for="resetEmail2">Email</label>
                    <input type="email" class="form-control" id="resetEmail2" required>
                </div>
                <div class="form-group">
                    <label for="resetCode">Reset Code</label>
                    <input type="text" class="form-control" id="resetCode" maxlength="10" required>
                </div>
                <div class="form-group">
                    <label for="resetNewPassword">New Password</label>
                    <input type="password" class="form-control" id="resetNewPassword" required>
                </div>
                <div class="form-group">
                    <label for="resetConfirmPassword">Confirm New Password</label>
                    <input type="password" class="form-control" id="resetConfirmPassword" required>
                </div>
                <div id="resetConfirmError" class="login-error">Error</div>
                <div style="display:flex; gap:0.75rem; margin-top:1rem;">
                    <button type="button" id="cancelResetConfirm" class="btn btn-secondary" style="flex:1;">Cancel</button>
                    <button type="submit" class="btn" style="flex:1;">Update Password</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Floating Chatbot Button (hidden until login) -->
    <button id="chatbotFab" class="chatbot-fab" style="display:none;">
        <i class="fas fa-comment-dots"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // Period Tracker Class
        class Period {
            constructor(startDateStr, endDateStr, symptoms = []) {
                this.startDate = new Date(startDateStr);
                this.endDate = new Date(endDateStr);
                this.symptoms = symptoms;
                this.id = Date.now().toString();
            }

            get duration() {
                return Math.floor((this.endDate - this.startDate) / (1000 * 60 * 60 * 24)) + 1;
            }

            toDict() {
                return {
                    id: this.id,
                    startDate: this.startDate.toISOString().split('T')[0],
                    endDate: this.endDate.toISOString().split('T')[0],
                    symptoms: this.symptoms
                };
            }

            static fromDict(data) {
                const period = new Period(data.startDate, data.endDate, data.symptoms);
                period.id = data.id;
                return period;
            }
        }

        class PeriodTracker {
            constructor() {
                this.periods = [];
                this.loadData();
            }

            loadData() {
                const data = localStorage.getItem('periodData');
                if (data) {
                    try {
                        const periodsData = JSON.parse(data);
                        this.periods = periodsData.map(p => Period.fromDict(p));
                        this.periods.sort((a, b) => a.startDate - b.startDate);
                    } catch (e) {
                        console.error('Error loading period data:', e);
                        this.periods = [];
                    }
                }
            }

            saveData() {
                localStorage.setItem('periodData', JSON.stringify(this.periods.map(p => p.toDict())));
            }

            addPeriod(startDateStr, endDateStr, symptoms) {
                const newPeriod = new Period(startDateStr, endDateStr, symptoms);
                this.periods.push(newPeriod);
                this.periods.sort((a, b) => a.startDate - b.startDate);
                this.saveData();
                return newPeriod;
            }

            deletePeriod(id) {
                this.periods = this.periods.filter(p => p.id !== id);
                this.saveData();
            }

            calculateCycleLengths() {
                if (this.periods.length < 2) return [];
                
                const cycleLengths = [];
                for (let i = 1; i < this.periods.length; i++) {
                    const length = Math.floor((this.periods[i].startDate - this.periods[i-1].startDate) / (1000 * 60 * 60 * 24));
                    cycleLengths.push(length);
                }
                return cycleLengths;
            }

            getStats() {
                const cycleLengths = this.calculateCycleLengths();
                if (cycleLengths.length === 0) return null;

                const avgCycle = cycleLengths.reduce((sum, length) => sum + length, 0) / cycleLengths.length;
                const avgPeriodDuration = this.periods.reduce((sum, p) => sum + p.duration, 0) / this.periods.length;
                
                // Calculate standard deviation
                const squaredDiffs = cycleLengths.map(length => Math.pow(length - avgCycle, 2));
                const avgSquaredDiff = squaredDiffs.reduce((sum, diff) => sum + diff, 0) / squaredDiffs.length;
                const stdDev = Math.sqrt(avgSquaredDiff);
                
                return {
                    avgCycle: Math.round(avgCycle * 10) / 10,
                    stdDev: Math.round(stdDev * 10) / 10,
                    avgPeriodDuration: Math.round(avgPeriodDuration * 10) / 10,
                    cycleLengths
                };
            }

            predictNextPeriod() {
                const stats = this.getStats();
                if (!stats || this.periods.length === 0) return null;

                const lastPeriod = this.periods[this.periods.length - 1];
                const predictedStart = new Date(lastPeriod.startDate);
                predictedStart.setDate(predictedStart.getDate() + Math.round(stats.avgCycle));
                
                // Create a prediction range using standard deviation
                const earliestStart = new Date(lastPeriod.startDate);
                earliestStart.setDate(earliestStart.getDate() + Math.round(stats.avgCycle - stats.stdDev));
                
                const latestStart = new Date(lastPeriod.startDate);
                latestStart.setDate(latestStart.getDate() + Math.round(stats.avgCycle + stats.stdDev));
                
                return {
                    predictedStart,
                    earliestStart,
                    latestStart
                };
            }

            getFertileWindow() {
                const prediction = this.predictNextPeriod();
                if (!prediction) return null;
                
                // Ovulation is typically ~14 days before the next period
                const ovulationDay = new Date(prediction.predictedStart);
                ovulationDay.setDate(ovulationDay.getDate() - 14);
                
                // Fertile window is 5 days ending on ovulation day
                const fertileWindowStart = new Date(ovulationDay);
                fertileWindowStart.setDate(fertileWindowStart.getDate() - 4);
                
                return {
                    start: fertileWindowStart,
                    end: ovulationDay
                };
            }
        }

        // Initialize the period tracker
    const periodTracker = new PeriodTracker();
    let riskChart = null;

        // Login & Signup functionality
        const loginPage = document.getElementById('loginPage');
        const appContainer = document.getElementById('appContainer');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const loginError = document.getElementById('loginError');
        const signupError = document.getElementById('signupError');
        const logoutBtn = document.getElementById('logoutBtn');
        const userName = document.getElementById('userName');
    const showSignupLink = document.getElementById('showSignupLink');
    const showLoginLink = document.getElementById('showLoginLink');
    const signupCta = document.getElementById('signupCta');
    const forgotCtaRow = document.getElementById('forgotCtaRow');
    // Verification form elements
    const verifyForm = document.getElementById('verifyForm');
    const verifyEmail = document.getElementById('verifyEmail');
    const verifyCode = document.getElementById('verifyCode');
    const verifyError = document.getElementById('verifyError');
    const resendCodeLink = document.getElementById('resendCodeLink');
    const backToLoginFromVerify = document.getElementById('backToLoginFromVerify');
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const changePasswordModal = document.getElementById('changePasswordModal');
    const changePasswordForm = document.getElementById('changePasswordForm');
    const cancelChangePwd = document.getElementById('cancelChangePwd');
    const changePwdError = document.getElementById('changePwdError');
    // User dropdown
    const userDropdownToggle = document.getElementById('userDropdownToggle');
    const userDropdownMenu = document.getElementById('userDropdownMenu');
    // Forgot password UI
    const forgotPasswordLink = document.getElementById('forgotPasswordLink');
    const forgotPasswordModal = document.getElementById('forgotPasswordModal');
    const forgotPasswordForm = document.getElementById('forgotPasswordForm');
    const cancelForgotPwd = document.getElementById('cancelForgotPwd');
    const forgotPwdError = document.getElementById('forgotPwdError');
    // Reset confirm UI
    const resetConfirmModal = document.getElementById('resetConfirmModal');
    const resetConfirmForm = document.getElementById('resetConfirmForm');
    const cancelResetConfirm = document.getElementById('cancelResetConfirm');
    const resetConfirmError = document.getElementById('resetConfirmError');

        window.addEventListener('DOMContentLoaded', () => {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const username = localStorage.getItem('username');
            if (isLoggedIn === 'true' && username) {
                showApp(username);
            }
            initializeFormValidation();
            initializeBMICalculation();
        });

        // Toggle between Sign In and Sign Up
        function showSignup() {
            loginForm.style.display = 'none';
            signupForm.style.display = 'flex';
            loginError.style.display = 'none';
            if (signupCta) signupCta.style.display = 'none';
            if (verifyForm) verifyForm.style.display = 'none';
            if (forgotCtaRow) forgotCtaRow.style.display = 'none';
        }

        function showSignin() {
            signupForm.style.display = 'none';
            loginForm.style.display = 'flex';
            signupError.style.display = 'none';
            if (signupCta) signupCta.style.display = 'block';
            if (verifyForm) verifyForm.style.display = 'none';
            if (forgotCtaRow) forgotCtaRow.style.display = 'block';
        }

        if (showSignupLink) {
            showSignupLink.addEventListener('click', showSignup);
        }
        if (showLoginLink) {
            showLoginLink.addEventListener('click', showSignin);
        }
        if (backToLoginFromVerify) {
            backToLoginFromVerify.addEventListener('click', showSignin);
        }

        // Dropdown toggle behavior
        if (userDropdownToggle && userDropdownMenu) {
            userDropdownToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                userDropdownMenu.classList.toggle('open');
            });
            document.addEventListener('click', () => userDropdownMenu.classList.remove('open'));
        }

        // Change Password UI handlers
        if (changePasswordBtn) {
            changePasswordBtn.addEventListener('click', () => {
                if (changePasswordModal) changePasswordModal.style.display = 'flex';
                if (changePwdError) changePwdError.style.display = 'none';
                const oldP = document.getElementById('oldPassword');
                const newP = document.getElementById('newPassword');
                const confP = document.getElementById('confirmPassword');
                if (oldP) oldP.value = '';
                if (newP) newP.value = '';
                if (confP) confP.value = '';
            });
        }
        if (cancelChangePwd) {
            cancelChangePwd.addEventListener('click', () => {
                if (changePasswordModal) changePasswordModal.style.display = 'none';
            });
        }

        // Forgot Password UI
        if (forgotPasswordLink) {
            forgotPasswordLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (forgotPasswordModal) forgotPasswordModal.style.display = 'flex';
                if (forgotPwdError) forgotPwdError.style.display = 'none';
                const email = document.getElementById('resetEmail');
                if (email) email.value = '';
            });
        }
        if (cancelForgotPwd) {
            cancelForgotPwd.addEventListener('click', () => {
                if (forgotPasswordModal) forgotPasswordModal.style.display = 'none';
            });
        }

        // Login functionality (Connected with FastAPI)
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            try {
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        username: username,
                        password: password
                    })
                });
                let data = null; let text = '';
                try {
                    const ct = response.headers.get('content-type') || '';
                    if (ct.includes('application/json')) {
                        data = await response.json();
                    } else {
                        text = await response.text();
                    }
                } catch (err) {
                    try { text = await response.text(); } catch { /* ignore */ }
                }
                if (response.ok) {
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('username', username);
                    if (data && data.access_token) {
                        localStorage.setItem('token', data.access_token); // Save token
                    }
                    showApp(username);
                } else {
                    let msg = 'Invalid credentials!';
                    if (data && data.detail) {
                        if (Array.isArray(data.detail) && data.detail[0]?.msg) msg = data.detail[0].msg;
                        else if (typeof data.detail === 'string') msg = data.detail;
                    } else if (text) {
                        msg = text;
                    }
                    loginError.textContent = msg;
                    loginError.style.display = 'block';
                    setTimeout(() => { loginError.style.display = 'none'; }, 3000);
                }
            } catch (error) {
                console.error('Error during login:', error);
                loginError.textContent = 'Server not reachable!';
                loginError.style.display = 'block';
                setTimeout(() => { loginError.style.display = 'none'; }, 3000);
            }
        });

        // Change Password submission
        if (changePasswordForm) {
            changePasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const oldPassword = (document.getElementById('oldPassword').value || '').trim();
                const newPassword = (document.getElementById('newPassword').value || '').trim();
                const confirmPassword = (document.getElementById('confirmPassword').value || '').trim();

                if (!oldPassword || !newPassword) {
                    changePwdError.textContent = 'Please fill out all fields';
                    changePwdError.style.display = 'block';
                    return;
                }
                if (newPassword.length < 8) {
                    changePwdError.textContent = 'New password must be at least 8 characters';
                    changePwdError.style.display = 'block';
                    return;
                }
                if (newPassword !== confirmPassword) {
                    changePwdError.textContent = 'New password and confirmation do not match';
                    changePwdError.style.display = 'block';
                    return;
                }

                try {
                    const token = localStorage.getItem('token');
                    const resp = await fetch('/auth/change-password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            ...(token ? { 'Authorization': `Bearer ${token}` } : {})
                        },
                        body: JSON.stringify({ old_password: oldPassword, new_password: newPassword })
                    });
                    const ct = resp.headers.get('content-type') || '';
                    const payload = ct.includes('application/json') ? await resp.json() : { detail: await resp.text() };
                    if (resp.ok) {
                        if (changePasswordModal) changePasswordModal.style.display = 'none';
                        showToast('Password updated successfully');
                    } else if (resp.status === 401) {
                        localStorage.setItem('isLoggedIn', 'false');
                        localStorage.removeItem('username');
                        localStorage.removeItem('token');
                        showLogin();
                        showToast('Session expired. Please log in again.');
                    } else {
                        const msg = (payload && payload.detail) ? (typeof payload.detail === 'string' ? payload.detail : (payload.detail[0]?.msg || 'Failed to update password')) : 'Failed to update password';
                        changePwdError.textContent = msg;
                        changePwdError.style.display = 'block';
                    }
                } catch (err) {
                    changePwdError.textContent = 'Network error. Please try again.';
                    changePwdError.style.display = 'block';
                }
            });
        }
        // Email verification submit
        if (verifyForm) {
            verifyForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = (verifyEmail?.value || '').trim();
                const code = (verifyCode?.value || '').trim();
                if (!email || !code) {
                    verifyError.textContent = 'Please enter email and verification code';
                    verifyError.style.display = 'block';
                    return;
                }
                try {
                    const resp = await fetch('/auth/verify-email', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, code })
                    });
                    const ct = resp.headers.get('content-type') || '';
                    const payload = ct.includes('application/json') ? await resp.json() : { detail: await resp.text() };
                    if (resp.ok) {
                        verifyError.style.color = '#27ae60';
                        verifyError.textContent = 'Email verified! You can now sign in.';
                        verifyError.style.display = 'block';
                        setTimeout(() => { verifyError.style.display = 'none'; showSignin(); }, 1200);
                    } else {
                        const msg = (payload && payload.detail) ? (typeof payload.detail === 'string' ? payload.detail : (payload.detail[0]?.msg || 'Verification failed')) : 'Verification failed';
                        verifyError.textContent = msg;
                        verifyError.style.color = '#e74c3c';
                        verifyError.style.display = 'block';
                    }
                } catch (err) {
                    verifyError.textContent = 'Network error. Please try again.';
                    verifyError.style.color = '#e74c3c';
                    verifyError.style.display = 'block';
                }
            });
        }

        // Resend code link
        if (resendCodeLink) {
            let cooldown = false;
            resendCodeLink.addEventListener('click', async (e) => {
                e.preventDefault();
                if (cooldown) return;
                const email = (verifyEmail?.value || '').trim();
                if (!email) {
                    verifyError.textContent = 'Enter your email first';
                    verifyError.style.color = '#e74c3c';
                    verifyError.style.display = 'block';
                    return;
                }
                try {
                    const resp = await fetch('/auth/resend-code', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email })
                    });
                    const ct = resp.headers.get('content-type') || '';
                    const payload = ct.includes('application/json') ? await resp.json() : { detail: await resp.text() };
                    if (resp.ok) {
                        showToast('Verification code sent');
                        cooldown = true;
                        resendCodeLink.style.pointerEvents = 'none';
                        resendCodeLink.style.opacity = '0.6';
                        setTimeout(() => {
                            cooldown = false;
                            resendCodeLink.style.pointerEvents = 'auto';
                            resendCodeLink.style.opacity = '1';
                        }, 60000);
                    } else {
                        const msg = (payload && payload.detail) ? (typeof payload.detail === 'string' ? payload.detail : (payload.detail[0]?.msg || 'Unable to resend code')) : 'Unable to resend code';
                        verifyError.textContent = msg;
                        verifyError.style.color = '#e74c3c';
                        verifyError.style.display = 'block';
                    }
                } catch (err) {
                    verifyError.textContent = 'Network error. Please try again.';
                    verifyError.style.color = '#e74c3c';
                    verifyError.style.display = 'block';
                }
            });
        }
        // Forgot Password submit -> request reset code
        if (forgotPasswordForm) {
            forgotPasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = (document.getElementById('resetEmail').value || '').trim();
                if (!email || !email.includes('@')) {
                    forgotPwdError.textContent = 'Please enter a valid email.';
                    forgotPwdError.style.display = 'block';
                    return;
                }
                try {
                    const resp = await fetch('/auth/reset-request', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email })
                    });
                    // Hide request modal regardless of status (avoid enumeration)
                    if (forgotPasswordModal) forgotPasswordModal.style.display = 'none';
                    // Prefill email in confirm modal
                    const email2 = document.getElementById('resetEmail2');
                    if (email2) email2.value = email;
                    if (resetConfirmModal) resetConfirmModal.style.display = 'flex';
                    showToast('If an account exists, a reset code has been sent.');
                } catch (err) {
                    forgotPwdError.textContent = 'Network error. Please try again.';
                    forgotPwdError.style.display = 'block';
                }
            });
        }

        // Cancel reset confirm
        if (cancelResetConfirm) {
            cancelResetConfirm.addEventListener('click', () => {
                if (resetConfirmModal) resetConfirmModal.style.display = 'none';
            });
        }

        // Reset confirm submit
        if (resetConfirmForm) {
            resetConfirmForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = (document.getElementById('resetEmail2').value || '').trim();
                const code = (document.getElementById('resetCode').value || '').trim();
                const newPassword = (document.getElementById('resetNewPassword').value || '').trim();
                const confirmPassword = (document.getElementById('resetConfirmPassword').value || '').trim();
                if (!email || !email.includes('@')) {
                    resetConfirmError.textContent = 'Please enter a valid email.';
                    resetConfirmError.style.display = 'block';
                    return;
                }
                if (!code) {
                    resetConfirmError.textContent = 'Please enter the reset code.';
                    resetConfirmError.style.display = 'block';
                    return;
                }
                if (newPassword.length < 8) {
                    resetConfirmError.textContent = 'New password must be at least 8 characters.';
                    resetConfirmError.style.display = 'block';
                    return;
                }
                if (newPassword !== confirmPassword) {
                    resetConfirmError.textContent = 'New password and confirmation do not match.';
                    resetConfirmError.style.display = 'block';
                    return;
                }
                try {
                    const resp = await fetch('/auth/reset-confirm', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, code, new_password: newPassword })
                    });
                    const ct = resp.headers.get('content-type') || '';
                    const payload = ct.includes('application/json') ? await resp.json() : { detail: await resp.text() };
                    if (resp.ok) {
                        if (resetConfirmModal) resetConfirmModal.style.display = 'none';
                        showToast('Password has been reset. You can sign in now.');
                        showSignin();
                    } else {
                        const msg = (payload && payload.detail) ? (typeof payload.detail === 'string' ? payload.detail : (payload.detail[0]?.msg || 'Reset failed')) : 'Reset failed';
                        resetConfirmError.textContent = msg;
                        resetConfirmError.style.display = 'block';
                    }
                } catch (err) {
                    resetConfirmError.textContent = 'Network error. Please try again.';
                    resetConfirmError.style.display = 'block';
                }
            });
        }
        // Signup functionality
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('signupUsername').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value.trim();

            // Basic client-side validation to avoid 422s
            if (username.length < 3 || username.length > 50) {
                signupError.textContent = 'Username must be 3-50 characters.';
                signupError.style.color = '#e74c3c';
                signupError.style.display = 'block';
                setTimeout(() => { signupError.style.display = 'none'; }, 3000);
                return;
            }
            if (password.length < 8 || password.length > 128) {
                signupError.textContent = 'Password must be 8-128 characters.';
                signupError.style.color = '#e74c3c';
                signupError.style.display = 'block';
                setTimeout(() => { signupError.style.display = 'none'; }, 3000);
                return;
            }
            // Very light email check; backend validates strictly
            if (!email.includes('@') || !email.includes('.')) {
                signupError.textContent = 'Please enter a valid email address.';
                signupError.style.color = '#e74c3c';
                signupError.style.display = 'block';
                setTimeout(() => { signupError.style.display = 'none'; }, 3000);
                return;
            }
            try {
                const response = await fetch('/auth/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        email: email,
                        password: password
                    })
                });
                let data = null; let text = '';
                try {
                    const ct = response.headers.get('content-type') || '';
                    if (ct.includes('application/json')) {
                        data = await response.json();
                    } else {
                        text = await response.text();
                    }
                } catch (err) {
                    try { text = await response.text(); } catch { /* ignore */ }
                }
                if (response.ok) {
                    // Switch to verification form, prefill email
                    if (verifyEmail) verifyEmail.value = email;
                    signupForm.style.display = 'none';
                    if (verifyForm) verifyForm.style.display = 'flex';
                    signupError.textContent = 'Signup successful! Please check your email for the verification code.';
                    signupError.style.color = '#27ae60';
                    signupError.style.display = 'block';
                    setTimeout(() => { signupError.style.display = 'none'; }, 3000);
                } else {
                    let msg = 'Signup failed!';
                    if (data && data.detail) {
                        if (Array.isArray(data.detail)) {
                            const first = data.detail[0];
                            if (first && first.msg) msg = first.msg;
                        } else if (typeof data.detail === 'string') {
                            msg = data.detail;
                        }
                    } else if (text) {
                        msg = text;
                    }
                    signupError.textContent = msg;
                    signupError.style.color = '#e74c3c';
                    signupError.style.display = 'block';
                    setTimeout(() => { signupError.style.display = 'none'; }, 3000);
                }
            } catch (error) {
                console.error('Error during signup:', error);
                signupError.textContent = 'Server not reachable!';
                signupError.style.color = '#e74c3c';
                signupError.style.display = 'block';
                setTimeout(() => { signupError.style.display = 'none'; }, 3000);
            }
        });

        // Logout functionality
        logoutBtn.addEventListener('click', () => {
            localStorage.setItem('isLoggedIn', 'false');
            localStorage.removeItem('username');
            localStorage.removeItem('token');
            showLogin();
        });

        function showApp(username) {
            loginPage.style.display = 'none';
            appContainer.style.display = 'flex';
            userName.textContent = `Welcome, ${username}`;
            // Show chatbot FAB only after successful login
            const fab = document.getElementById('chatbotFab');
            if (fab) fab.style.display = 'flex';
        }
        function showLogin() {
            loginPage.style.display = 'flex';
            appContainer.style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('signupUsername').value = '';
            document.getElementById('signupEmail').value = '';
            document.getElementById('signupPassword').value = '';
            // Hide chatbot FAB on login/register screens
            const fab = document.getElementById('chatbotFab');
            if (fab) fab.style.display = 'none';
        }


        // Navigation functionality
        const navButtons = document.querySelectorAll('.nav-btn');
        const sections = document.querySelectorAll('.section');

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetSection = button.getAttribute('data-section');
                
                // Update active button
                navButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                // Show target section
                sections.forEach(section => {
                    section.classList.remove('active');
                    if (section.id === targetSection) {
                        section.classList.add('active');
                    }
                });
                
                // Update period tracker if navigating to it
                if (targetSection === 'tracker') {
                    setTimeout(() => {
                        updateDashboard();
                        renderPeriodHistory();
                    }, 100);
                }
            });
        });

        // Feature cards on landing page
        const featureCards = document.querySelectorAll('.feature-card, .secondary-feature, .main-feature-cta');
        featureCards.forEach(card => {
            card.addEventListener('click', (e) => {
                e.preventDefault();
                const feature = card.getAttribute('data-feature');
                
                // Find and click the corresponding nav button
                navButtons.forEach(btn => {
                    if (btn.getAttribute('data-section') === feature) {
                        btn.click();
                    }
                });
            });
        });

        // Toast notification
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
        
        // Floating Chatbot Button functionality
        const chatbotFab = document.getElementById('chatbotFab');
        chatbotFab.addEventListener('click', () => {
            // Show chatbot section and hide others
            sections.forEach(section => {
                section.classList.remove('active');
                if (section.id === 'chatbot') {
                    section.classList.add('active');
                }
            });
        });
        // Form Validation Functions
        function initializeFormValidation() {
            // Add input event listeners to all required fields
            const requiredFields = document.querySelectorAll('[required]');
            
            requiredFields.forEach(field => {
                field.addEventListener('input', function() {
                    // Remove error class when user starts typing
                    if (this.value.trim()) {
                        this.classList.remove('error');
                    }
                });
                
                field.addEventListener('blur', function() {
                    // Validate on blur (when user leaves the field)
                    validateField(this);
                });
            });
        }

        // Separate function to validate individual field
        function validateField(field) {
            const value = field.value.trim();
            
            // Check if field is empty
            if (!value && field.hasAttribute('required')) {
                field.classList.add('error');
                return false;
            }
            
            // Additional validation for number fields
            if (field.type === 'number' && value) {
                const numValue = parseFloat(value);
                
                // Check if it's a valid number
                if (isNaN(numValue)) {
                    field.classList.add('error');
                    return false;
                }
                
                // Check if it's within the specified range
                if (field.min && numValue < parseFloat(field.min)) {
                    field.classList.add('error');
                    return false;
                }
                
                if (field.max && numValue > parseFloat(field.max)) {
                    field.classList.add('error');
                    return false;
                }
            }
            
            // If all checks pass, remove error class
            field.classList.remove('error');
            return true;
        }

        // BMI Auto-Calculation
        function initializeBMICalculation() {
            const heightField = document.getElementById('height');
            const weightField = document.getElementById('weight');
            const bmiField = document.getElementById('bmi');
            
            function calculateBMI() {
                const height = parseFloat(heightField.value);
                const weight = parseFloat(weightField.value);
                
                if (!isNaN(height) && !isNaN(weight) && height > 0) {
                    const bmi = weight / ((height / 100) ** 2);
                    bmiField.value = bmi.toFixed(1);
                    bmiField.classList.remove('error');
                    bmiField.classList.add('success');
                }
            }
            
            heightField.addEventListener('input', calculateBMI);
            weightField.addEventListener('input', calculateBMI);
            
            // Also validate BMI field when manually changed
            bmiField.addEventListener('blur', function() {
                validateField(this);
            });
        }

        // Enhanced Risk Prediction Wizard
        let currentStep = 1;
        const totalSteps = 4;
        const stepIndicators = document.querySelectorAll('.step-indicator');
        const stepContents = document.querySelectorAll('.step-content');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const progressBar = document.getElementById('progressBar');

        // Step navigation
        function showStep(step) {
            // Update step indicators
            stepIndicators.forEach((indicator, index) => {
                if (index < step - 1) {
                    indicator.classList.add('completed');
                    indicator.classList.remove('active');
                } else if (index === step - 1) {
                    indicator.classList.add('active');
                    indicator.classList.remove('completed');
                } else {
                    indicator.classList.remove('active', 'completed');
                }
            });

            // Update step content
            stepContents.forEach((content, index) => {
                if (index === step - 1) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });

            // Update progress bar
            const progress = (step / totalSteps) * 100;
            progressBar.style.width = `${progress}%`;

            // Update buttons
            if (step === 1) {
                prevBtn.style.display = 'none';
            } else {
                prevBtn.style.display = 'flex';
            }

            if (step === totalSteps) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'flex';
                updateSummary();
            } else {
                nextBtn.style.display = 'flex';
                submitBtn.style.display = 'none';
            }

            currentStep = step;
        }

        // Validate current step
        function validateStep(step) {
            const currentStepElement = document.getElementById(`step${step}`);
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!validateField(field)) {
                    isValid = false;
                }
            });

            return isValid;
        }

        // Update summary on step 4
        function updateSummary() {
            const summaryGrid = document.getElementById('summaryGrid');
            const formData = collectFormData();
            
            const summaryItems = [
                { label: 'Age', value: formData["Age"] },
                { label: 'Height', value: `${formData["Height(cm)"]} cm` },
                { label: 'Weight', value: `${formData["Weight(kg)"]} kg` },
                { label: 'BMI', value: formData["BMI"] },
                { label: 'Blood Group', value: formData["Blood Group"] },
                { label: 'Cycle Length', value: `${formData["Cycle Length(days)"]} days` },
                { label: 'Cycle Regularity', value: formData["Cycle Regularity (Y/N)"] === 'Y' ? 'Regular' : 'Irregular' },
                { label: 'Exercise', value: `${formData["Exercise (days/week)"]} days/week` },
                { label: 'Sleep', value: `${formData["Sleep (hours/day)"]} hours/day` },
                { label: 'Stress Level', value: formData["Stress Level (1-10)"] },
                { label: 'Water Intake', value: `${formData["Water Intake (liters/day)"]} L/day` },
                { label: 'Fast Food', value: `${formData["Fast Food (meals/week)"]} meals/week` }
            ];
            summaryGrid.innerHTML = summaryItems.map(item => `
                <div class="summary-item">
                    <span class="summary-label">${item.label}:</span>
                    <span class="summary-value">${item.value}</span>
                </div>
            `).join('');
        }

        // Collect form data
        function collectFormData() {
            return {
                "Age": document.getElementById('age').value,
                "Height(cm)": document.getElementById('height').value,
                "Weight(kg)": document.getElementById('weight').value,
                "BMI": document.getElementById('bmi').value,
                "Blood Group": document.getElementById('blood_group').value,
                "Cycle Length(days)": document.getElementById('cycle_length').value,
                "Cycle Regularity (Y/N)": document.getElementById('cycle_reg').value,
                "Marriage Status (Yrs)": document.getElementById('marriage_years').value,
                "Pregnant (Y/N)": document.getElementById('pregnant').value,
                "No. of Abortions": document.getElementById('abortions').value,
                "Hair Loss (Y/N)": document.getElementById('hair_loss').value,
                "Pimples/Acne (Y/N)": document.getElementById('pimples').value,
                "Excess Hair Growth (Y/N)": document.getElementById('excess_hair').value,
                "Difficulty in Weight Loss (Y/N)": document.getElementById('weight_loss_diff').value,
                "Skin Darkening (Y/N)": document.getElementById('skin_darkening').value,
                "Exercise (days/week)": document.getElementById('exercise').value,
                "Smoking (Y/N)": document.getElementById('smoking').value,
                "Alcohol (drinks/week)": document.getElementById('alcohol').value,
                "Sleep (hours/day)": document.getElementById('sleep').value,
                "Stress Level (1-10)": document.getElementById('stress').value,
                "Water Intake (liters/day)": document.getElementById('water').value,
                "Fast Food (meals/week)": document.getElementById('fast_food').value,
                "Coffee/Tea (cups/day)": document.getElementById('coffee').value,
                "Family History of Hormonal Issues (Y/N)": document.getElementById('fam_hist').value,
                "Skin Type": document.getElementById('skin_type').value,
                "Birth Control (Y/N)": document.getElementById('birth_control').value,
                "Regular Medication (Y/N)": document.getElementById('regular_med').value
            };
        }

        // Button event listeners
        prevBtn.addEventListener('click', () => {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        });

        nextBtn.addEventListener('click', () => {
            if (validateStep(currentStep)) {
                if (currentStep < totalSteps) {
                    showStep(currentStep + 1);
                }
            } else {
                showToast('Please fill in all required fields correctly');
            }
        });

        // Keep last prediction and inputs to forward to doctor
        let lastPredictionInputs = null;
        let lastPredictionResult = null;

        submitBtn.addEventListener('click', async () => {
            if (validateStep(currentStep)) {
                const formData = collectFormData();
                
                try {
                    // Send data to backend
                    const token = localStorage.getItem('token');
                    const response = await fetch('/predict', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            ...(token ? { 'Authorization': `Bearer ${token}` } : {})
                            
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    const data = await response.json();
                    
                    // Stash context for connect-to-doctor flow
                    lastPredictionInputs = formData;
                    lastPredictionResult = data;

                    // Display results
                    displayRiskResults(data);
                } catch (error) {
                    console.error('Error predicting risk:', error);
                    showToast('Error calculating risk. Please try again.');
                }
            } else {
                showToast('Please fill in all required fields correctly');
            }
        });

        // Display risk results
        function displayRiskResults(data) {
            const riskResult = document.getElementById('riskResult');
            const riskScore = document.getElementById('riskScore');
            const riskFill = document.getElementById('riskFill');
            const riskPercentage = document.getElementById('riskPercentage');
            const riskLabel = document.getElementById('riskLabel');
            const riskExplanation = document.getElementById('riskExplanation');
            const riskLevel = document.getElementById('riskLevel');
            const riskPrecautions = document.getElementById('riskPrecautions');
            const precautionsList = document.getElementById('precautionsList');
            const contactDoctorBtn = document.getElementById('contactDoctorBtn');

            // Show results section
            riskResult.classList.add('show');
            
            // Animate risk score
            let currentScore = 0;
            const targetScore = data.risk;
            const increment = targetScore / 50;
            const timer = setInterval(() => {
                currentScore += increment;
                if (currentScore >= targetScore) {
                    currentScore = targetScore;
                    clearInterval(timer);
                }
                riskScore.textContent = `${Math.round(currentScore)}%`;
                riskFill.style.width = `${currentScore}%`;
                riskPercentage.textContent = `${Math.round(currentScore)}%`;
            }, 30);
            
            // Determine risk level
            let riskLevelType;
            if (data.risk < 30) {
                riskLevelType = 'low';
                riskScore.style.color = '#4CAF50';
                riskFill.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
                riskLabel.textContent = 'Low Risk - Keep up the good work!';
            } else if (data.risk < 60) {
                riskLevelType = 'medium';
                riskScore.style.color = '#FF9800';
                riskFill.style.background = 'linear-gradient(90deg, #FF9800, #FFC107)';
                riskLabel.textContent = 'Moderate Risk - Consider lifestyle changes';
            } else {
                riskLevelType = 'high';
                riskScore.style.color = '#F44336';
                riskFill.style.background = 'linear-gradient(90deg, #F44336, #E91E63)';
                riskLabel.textContent = 'High Risk - Please consult a healthcare professional';
            }
            
            // Update risk level indicator
            const riskText = riskLevel.querySelector('.risk-text');
            riskText.textContent = riskContent[riskLevelType].title;
            riskLevel.className = `risk-level risk-${riskLevelType}`;
            
            // Update precautions
            precautionsList.innerHTML = '';
            riskContent[riskLevelType].precautions.forEach(precaution => {
                const li = document.createElement('li');
                li.textContent = precaution;
                precautionsList.appendChild(li);
            });
            
            // Create or update chart
            createRiskChart(data.featureImportance);
            
            // Scroll to results
            setTimeout(() => {
                riskResult.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 500);
        }

        // Risk level specific content
        const riskContent = {
            low: {
                title: "Low Risk",
                color: "#4CAF50",
                precautions: [
                    "Maintain a healthy diet rich in fruits, vegetables, and whole grains",
                    "Exercise regularly (at least 30 minutes, 5 days a week)",
                    "Maintain a healthy weight",
                    "Get regular check-ups with your healthcare provider",
                    "Monitor your menstrual cycle for any changes"
                ]
            },
            medium: {
                title: "Medium Risk",
                color: "#FF9800",
                precautions: [
                    "Schedule an appointment with a gynecologist for further evaluation",
                    "Consider lifestyle changes: diet, exercise, stress management",
                    "Monitor for symptoms like irregular periods, excess hair growth, acne",
                    "Consider tracking your menstrual cycle more closely",
                    "Discuss birth control options with your doctor if needed"
                ]
            },
            high: {
                title: "High Risk",
                color: "#F44336",
                precautions: [
                    "Schedule an appointment with a gynecologist or endocrinologist as soon as possible",
                    "Request comprehensive hormonal testing and ultrasound evaluation",
                    "Discuss treatment options including medication and lifestyle changes",
                    "Consider consulting with a nutritionist for dietary guidance",
                    "Monitor for complications like insulin resistance, high cholesterol",
                    "Join a PCOS support group for emotional support and information"
                ]
            }
        };

        // Create risk chart
        function createRiskChart(featureImportance) {
            // Destroy existing chart if it exists
            if (riskChart) {
                riskChart.destroy();
            }
            
            // Prepare data
            const features = Object.keys(featureImportance);
            const values = Object.values(featureImportance);
            
            // Sort features by importance
            const sortedIndices = values
                .map((value, index) => ({ value, index }))
                .sort((a, b) => b.value - a.value)
                .map(item => item.index);
            
            const sortedFeatures = sortedIndices.map(index => features[index]);
            const sortedValues = sortedIndices.map(index => values[index]);
            
            // Create new chart
            const ctx = document.getElementById('riskChart').getContext('2d');
            riskChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedFeatures,
                    datasets: [{
                        label: 'Influence on Risk (%)',
                        data: sortedValues,
                        backgroundColor: sortedValues.map((value, index) => {
                            // Create gradient colors based on importance
                            const hue = 270 - (value * 2);
                            return `hsla(${hue}, 70%, 60%, 0.8)`;
                        }),
                        borderColor: sortedValues.map((value, index) => {
                            const hue = 270 - (value * 2);
                            return `hsla(${hue}, 70%, 50%, 1)`;
                        }),
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Risk Factors by Importance',
                            font: {
                                family: 'Playfair Display',
                                size: 18,
                                weight: 'bold'
                            },
                            padding: 20
                        },
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(142, 68, 173, 0.8)',
                            titleFont: {
                                family: 'Inter',
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                family: 'Inter',
                                size: 13
                            },
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    return `${context.raw}% influence on your risk`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: Math.max(...sortedValues) + 5,
                            title: {
                                display: true,
                                text: 'Influence on Risk (%)',
                                font: {
                                    family: 'Inter',
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    family: 'Inter',
                                    size: 12
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // Connect to a Doctor button -> open modal with details (no PDF preview/download)
        document.getElementById('contactDoctorBtn').addEventListener('click', async () => {
            openDoctorModal();
            // Load cities and recommendations
            try {
                const token = localStorage.getItem('token');
                const res = await fetch('/doctor/cities', { headers: { ...(token ? { 'Authorization': `Bearer ${token}` } : {}) } });
                const { cities } = await res.json();
                const citySel = document.getElementById('pCity');
                citySel.innerHTML = '';
                (cities || []).forEach(c => { const o=document.createElement('option'); o.value=c; o.textContent=c; citySel.appendChild(o); });
                const changeCity = async () => {
                    try {
                        const docRes = await fetch(`/doctor/recommend?city=${encodeURIComponent(citySel.value)}`, { headers: { ...(token ? { 'Authorization': `Bearer ${token}` } : {}) } });
                        const { doctors } = await docRes.json();
                        const dSel = document.getElementById('doctorSelect');
                        dSel.innerHTML = '';
                        (doctors || []).forEach(d => { const o=document.createElement('option'); o.value=d.id; o.textContent=`${d.name} â€“ ${d.specialty}`; dSel.appendChild(o); });
                    } catch {}
                };
                citySel.onchange = changeCity; await changeCity();
            } catch {}
        });

        // Period Tracker Tab Navigation
        const trackerTabs = document.querySelectorAll('.tracker-tab');
        const trackerContents = document.querySelectorAll('.tracker-content');

        trackerTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.getAttribute('data-tab');
                
                // Update active tab
                trackerTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show target content
                trackerContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === targetTab) {
                        content.classList.add('active');
                    }
                });
                
            });
        });

        // Period Tracker Functions
        function updateDashboard() {
            const stats = periodTracker.getStats();
            const lastPeriod = periodTracker.periods.length > 0 ? 
                periodTracker.periods[periodTracker.periods.length - 1] : null;
            const prediction = periodTracker.predictNextPeriod();
            const fertileWindow = periodTracker.getFertileWindow();
            
            // Update stats
            document.getElementById('avgCycleLength').textContent = 
                stats ? `${stats.avgCycle} days` : '--';
            document.getElementById('avgPeriodDuration').textContent = 
                stats ? `${stats.avgPeriodDuration} days` : '--';
            document.getElementById('lastPeriodStart').textContent = 
                lastPeriod ? formatDate(lastPeriod.startDate) : '--';
            document.getElementById('cycleRegularity').textContent = 
                stats ? (stats.stdDev > 7 ? 'Irregular' : 'Regular') : '--';
            
            // Update predictions
            document.getElementById('nextPeriodDate').textContent = 
                prediction ? formatDate(prediction.predictedStart) : '--';
            
            if (prediction) {
                document.getElementById('periodRange').textContent = 
                    `${formatDate(prediction.earliestStart)} to ${formatDate(prediction.latestStart)}`;
            } else {
                document.getElementById('periodRange').textContent = '--';
            }
            
            if (fertileWindow) {
                document.getElementById('fertileWindow').textContent = 
                    `${formatDate(fertileWindow.start)} - ${formatDate(fertileWindow.end)}`;
            } else {
                document.getElementById('fertileWindow').textContent = '--';
            }
        }

        function renderPeriodHistory() {
            const periodList = document.getElementById('periodList');
            periodList.innerHTML = '';
            
            if (periodTracker.periods.length === 0) {
                periodList.innerHTML = '<p>No periods recorded yet.</p>';
                return;
            }
            
            // Sort periods in descending order for display
            const sortedPeriods = [...periodTracker.periods].reverse();
            
            sortedPeriods.forEach(period => {
                const periodItem = document.createElement('div');
                periodItem.className = 'period-item';
                
                const symptomsTags = period.symptoms.map(symptom => 
                    `<span class="symptom-tag">${symptom}</span>`
                ).join('');
                
                periodItem.innerHTML = `
                    <div class="period-info">
                        <h4>${formatDate(period.startDate)} - ${formatDate(period.endDate)} (${period.duration} days)</h4>
                        <div class="period-details">
                            <span><i class="fas fa-calendar"></i> Cycle Day: ${getCycleDay(period.startDate)}</span>
                        </div>
                        <div class="period-symptoms">
                            ${symptomsTags || '<span>No symptoms recorded</span>'}
                        </div>
                    </div>
                    <div class="period-actions">
                        <button class="icon-btn delete" data-id="${period.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                periodList.appendChild(periodItem);
            });
            
            // Add delete event listeners
            document.querySelectorAll('.period-actions .delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.getAttribute('data-id');
                    if (confirm('Are you sure you want to delete this period?')) {
                        periodTracker.deletePeriod(id);
                        updateDashboard();
                        renderPeriodHistory();
                        showToast('Period deleted successfully');
                    }
                });
            });
        }
        

        // Period Form Handling
        const periodForm = document.getElementById('periodForm');
        const symptomText = document.getElementById('symptomText');
        const addSymptomBtn = document.getElementById('addSymptomBtn');
        const symptomTags = document.getElementById('symptomTags');
        let currentSymptoms = [];

        addSymptomBtn.addEventListener('click', addSymptom);
        symptomText.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addSymptom();
            }
        });

        function addSymptom() {
            const symptom = symptomText.value.trim();
            if (symptom && !currentSymptoms.includes(symptom)) {
                currentSymptoms.push(symptom);
                renderSymptomTags();
                symptomText.value = '';
            }
        }

        function removeSymptom(symptom) {
            currentSymptoms = currentSymptoms.filter(s => s !== symptom);
            renderSymptomTags();
        }

        function renderSymptomTags() {
            symptomTags.innerHTML = currentSymptoms.map(symptom => 
                `<div class="symptom-tag">
                    ${symptom}
                    <button type="button" onclick="removeSymptom('${symptom}')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>`
            ).join('');
        }

        periodForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const startDate = document.getElementById('periodStartDate').value;
            const endDate = document.getElementById('periodEndDate').value;
            
            if (!startDate || !endDate) {
                showToast('Please enter both start and end dates');
                return;
            }
            
            if (new Date(endDate) < new Date(startDate)) {
                showToast('End date cannot be before start date');
                return;
            }
            
            periodTracker.addPeriod(startDate, endDate, [...currentSymptoms]);
            
            // Reset form
            periodForm.reset();
            currentSymptoms = [];
            renderSymptomTags();
            
            // Update UI
            updateDashboard();
            renderPeriodHistory();
            
            showToast('Period added successfully');
            
            // Switch to dashboard tab
            document.querySelector('.tracker-tab[data-tab="dashboard"]').click();
        });

        // Helper Functions
        function formatDate(date) {
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
        }

        function getCycleDay(date) {
            if (periodTracker.periods.length === 0) return 1;
            
            // Find the period that this date belongs to or follows
            let cycleStart = periodTracker.periods[0].startDate;
            let cycleEnd = null;
            
            for (let i = 0; i < periodTracker.periods.length; i++) {
                if (date >= periodTracker.periods[i].startDate && date <= periodTracker.periods[i].endDate) {
                    // Date is within a period
                    return Math.floor((date - periodTracker.periods[i].startDate) / (1000 * 60 * 60 * 24)) + 1;
                } else if (date > periodTracker.periods[i].endDate && (i === periodTracker.periods.length - 1 || date < periodTracker.periods[i+1].startDate)) {
                    // Date is in the cycle after this period
                    cycleStart = periodTracker.periods[i].startDate;
                    if (i < periodTracker.periods.length - 1) {
                        cycleEnd = periodTracker.periods[i+1].startDate;
                    }
                    break;
                }
            }
            
            // Calculate cycle day
            const cycleDay = Math.floor((date - cycleStart) / (1000 * 60 * 60 * 24)) + 1;
            return cycleDay;
        }

        // Chatbot functionality
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            
            if (isUser) {
                messageDiv.classList.add('user');
            }
            
            const avatar = document.createElement('div');
            avatar.classList.add('message-avatar');
            avatar.textContent = isUser ? 'ðŸ™â€â™€ï¸' : 'ðŸ‘©â€âš•ï¸';
            
            const messageContent = document.createElement('div');
            messageContent.classList.add('message-content');
            
            // Parse and render HTML content
            if (isUser) {
                messageContent.textContent = content;
            } else {
                // For bot messages, render as HTML to support formatting
                messageContent.innerHTML = content;
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Add user message
            addMessage(message, true);
            chatInput.value = '';
            
            // Add loading indicator
            const loadingDiv = document.createElement('div');
            loadingDiv.classList.add('message');
            loadingDiv.id = 'loadingMessage';
            
            const avatar = document.createElement('div');
            avatar.classList.add('message-avatar');
            avatar.textContent = 'ðŸ‘©â€âš•ï¸';
            
            const messageContent = document.createElement('div');
            messageContent.classList.add('message-content');
            messageContent.innerHTML = 'Thinking<span class="spinner"></span>';
            
            loadingDiv.appendChild(avatar);
            loadingDiv.appendChild(messageContent);
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            try {
                // Send message to backend
                const token = localStorage.getItem('token');
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(token ? { 'Authorization': `Bearer ${token}` } : {})
                    },
                    body: JSON.stringify({ message })
                });
                
                const data = await response.json();
                
                // Remove loading indicator
                const loadingMessage = document.getElementById('loadingMessage');
                if (loadingMessage) {
                    loadingMessage.remove();
                }
                
                // Add bot response
                addMessage(data.response || "I'm sorry, I couldn't process your request. Please try again.");
            } catch (error) {
                console.error('Error sending message:', error);
                
                // Remove loading indicator
                const loadingMessage = document.getElementById('loadingMessage');
                if (loadingMessage) {
                    loadingMessage.remove();
                }
                
                // Add error message
                addMessage("I'm having trouble connecting to my brain right now. Please try again later.");
            }
        }

        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Fitness tracker functionality
        const fitnessForm = document.getElementById('fitnessForm');
        const fitnessDate = document.getElementById('fitnessDate');
        const stepsInput = document.getElementById('stepsInput');
        const exerciseInput = document.getElementById('exerciseInput');
        const waterInput = document.getElementById('waterInput');
        const sleepInput = document.getElementById('sleepInput');
        const weightInput = document.getElementById('weightInput');
        const stressInput = document.getElementById('stressInput');
        const moodSelect = document.getElementById('moodSelect');
        const flowSelect = document.getElementById('flowSelect');
        const painInput = document.getElementById('painInput');
        const crampsChk = document.getElementById('crampsChk');
        const acneChk = document.getElementById('acneChk');
        const bloatingChk = document.getElementById('bloatingChk');
        const headachesChk = document.getElementById('headachesChk');
        const cravingsChk = document.getElementById('cravingsChk');
        const fatigueChk = document.getElementById('fatigueChk');
        const medicationsInput = document.getElementById('medicationsInput');
        const notesInput = document.getElementById('notesInput');
    const fitnessSummary = document.getElementById('fitnessSummary');
    const fitnessHistory = document.getElementById('fitnessHistory');

        function setToday() {
            if (fitnessDate) {
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth()+1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                fitnessDate.value = `${yyyy}-${mm}-${dd}`;
            }
        }
        setToday();
        const todayDateBtn = document.getElementById('todayDateBtn');
        if (todayDateBtn) { todayDateBtn.addEventListener('click', setToday); }

        async function loadFitness() {
            const token = localStorage.getItem('token');
            if (!token) return;
            try {
                const end = new Date();
                const start = new Date();
                start.setDate(end.getDate() - 13);
                const s = start.toISOString().slice(0,10);
                const e = end.toISOString().slice(0,10);
                const [logsResp, statsResp] = await Promise.all([
                    fetch(`/tracker/logs?start=${s}&end=${e}`, { headers: { 'Authorization': `Bearer ${token}` } }),
                    fetch(`/tracker/stats?window_days=30`, { headers: { 'Authorization': `Bearer ${token}` } })
                ]);
                const logs = logsResp.ok ? await logsResp.json() : [];
                const stats = statsResp.ok ? await statsResp.json() : null;
                renderFitness(logs, stats);
            } catch (err) {
                console.error('Failed to load fitness logs', err);
            }
        }

        function renderFitness(logs, stats) {
            // Summary
            if (fitnessSummary) {
                const parts = [];
                if (stats) {
                    parts.push(`<div class="prediction-title">Last 30 days overview</div>`);
                    parts.push(`<div class=\"prediction-item\"><div class=\"prediction-icon\">ðŸ’¤</div><div class=\"prediction-text\">Avg sleep: <strong>${stats.avg_sleep_hours ?? '--'} h</strong></div></div>`);
                    parts.push(`<div class=\"prediction-item\"><div class=\"prediction-icon\">ðŸ’§</div><div class=\"prediction-text\">Avg water: <strong>${stats.avg_water_liters ?? '--'} L</strong></div></div>`);
                    parts.push(`<div class=\"prediction-item\"><div class=\"prediction-icon\">ðŸƒâ€â™€ï¸</div><div class=\"prediction-text\">Avg exercise: <strong>${stats.avg_exercise_minutes ?? '--'} min</strong></div></div>`);
                    parts.push(`<div class=\"prediction-item\"><div class=\"prediction-icon\">ðŸ˜£</div><div class=\"prediction-text\">Avg pain: <strong>${stats.avg_pain_level ?? '--'}</strong></div></div>`);
                    parts.push(`<div class=\"prediction-item\"><div class=\"prediction-icon\">ðŸ§ </div><div class=\"prediction-text\">Avg stress: <strong>${stats.avg_stress_level ?? '--'}</strong></div></div>`);
                }
                fitnessSummary.innerHTML = parts.join('');
            }

            // History
            if (fitnessHistory) {
                fitnessHistory.innerHTML = '';
                logs.forEach(l => {
                    const item = document.createElement('div');
                    item.className = 'period-item';
                    item.innerHTML = `
                        <div class=\"period-info\">
                            <h4>${l.day}</h4>
                            <div class=\"period-details\">
                                <span>Sleep: <strong>${l.sleep_hours ?? '--'}h</strong></span>
                                <span>Water: <strong>${l.water_liters ?? '--'}L</strong></span>
                                <span>Exercise: <strong>${l.exercise_minutes ?? '--'}m</strong></span>
                                <span>Steps: <strong>${l.steps ?? '--'}</strong></span>
                                <span>Pain: <strong>${l.pain_level ?? '--'}</strong></span>
                                <span>Flow: <strong>${l.flow_level || 'none'}</strong></span>
                            </div>
                            <div class=\"period-symptoms\">
                                ${(l.cramps ? '<span class=\"symptom-tag\">Cramps</span>' : '')}
                                ${(l.acne ? '<span class=\"symptom-tag\">Acne</span>' : '')}
                                ${(l.bloating ? '<span class=\"symptom-tag\">Bloating</span>' : '')}
                                ${(l.headaches ? '<span class=\"symptom-tag\">Headaches</span>' : '')}
                                ${(l.cravings ? '<span class=\"symptom-tag\">Cravings</span>' : '')}
                                ${(l.fatigue ? '<span class=\"symptom-tag\">Fatigue</span>' : '')}
                            </div>
                        </div>
                    `;
                    fitnessHistory.appendChild(item);
                });
            }
        }

        if (fitnessForm) {
            fitnessForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const token = localStorage.getItem('token');
                if (!token) { showToast('Please log in'); return; }
                const body = {
                    day: fitnessDate.value,
                    steps: stepsInput.value ? parseInt(stepsInput.value) : undefined,
                    exercise_minutes: exerciseInput.value ? parseInt(exerciseInput.value) : undefined,
                    water_liters: waterInput.value ? parseFloat(waterInput.value) : undefined,
                    sleep_hours: sleepInput.value ? parseFloat(sleepInput.value) : undefined,
                    weight_kg: weightInput.value ? parseFloat(weightInput.value) : undefined,
                    stress_level: stressInput.value ? parseInt(stressInput.value) : undefined,
                    mood: moodSelect.value || undefined,
                    flow_level: flowSelect.value || undefined,
                    pain_level: painInput.value ? parseInt(painInput.value) : undefined,
                    cramps: crampsChk.checked,
                    acne: acneChk.checked,
                    bloating: bloatingChk.checked,
                    headaches: headachesChk.checked,
                    cravings: cravingsChk.checked,
                    fatigue: fatigueChk.checked,
                    medications: medicationsInput.value ? medicationsInput.value.split(',').map(s => s.trim()).filter(Boolean) : [],
                    notes: notesInput.value || undefined,
                };
                try {
                    const resp = await fetch('/tracker/logs', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                        body: JSON.stringify(body)
                    });
                    if (resp.ok) {
                        showToast('Saved');
                        // Build a concise prompt for AI suggestions (include all collected fields)
                        const notesSnippet = body.notes ? body.notes.slice(0, 140) : '';
                        const medsList = (body.medications || []).slice(0, 5).join(', ');
                        const prompt = `Provide concise daily wellbeing recommendations for a woman (PCOS-aware) based on: ` +
                            `steps=${body.steps ?? 'n/a'}, exercise_min=${body.exercise_minutes ?? 'n/a'}, water_L=${body.water_liters ?? 'n/a'}, ` +
                            `sleep_h=${body.sleep_hours ?? 'n/a'}, stress=${body.stress_level ?? 'n/a'}, mood=${body.mood || 'n/a'}, ` +
                            `flow=${body.flow_level || 'none'}, pain=${body.pain_level ?? 0}, weight_kg=${body.weight_kg ?? 'n/a'}, ` +
                            `symptoms=[${['cramps','acne','bloating','headaches','cravings','fatigue'].filter(k => body[k]).join(', ')}], ` +
                            `meds=[${medsList || 'none'}]` + (notesSnippet ? `, notes="${notesSnippet}"` : '') + `. ` +
                            `Return a short, structured list. No chain-of-thought.`;

                        // Render AI suggestion into dedicated box (not overwritten by summary)
                        const box = document.getElementById('aiSuggestionBox');
                        if (box) box.innerHTML = `<span style="color:#6c3483;">Loading AI suggestions...</span>`;
                        try {
                            // Dev verification: ensure full payload reaches Groq backend as part of the prompt
                            console.debug('[AI Suggest] Sending prompt with context:', { day: body.day, steps: body.steps, exercise_minutes: body.exercise_minutes, water_liters: body.water_liters, sleep_hours: body.sleep_hours, weight_kg: body.weight_kg, stress_level: body.stress_level, mood: body.mood, flow_level: body.flow_level, pain_level: body.pain_level, symptoms: ['cramps','acne','bloating','headaches','cravings','fatigue'].filter(k => body[k]), medications: body.medications, notes: notesSnippet });
                            const aiResp = await fetch('/ai-suggest', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                                body: JSON.stringify({ prompt })
                            });
                            const aiData = await aiResp.json();
                            if (!aiResp.ok || !aiData || !aiData.suggestion) {
                                if (box) box.innerHTML = `<span style=\"color:#e74c3c;\">${(aiData && aiData.error) ? aiData.error : 'No suggestion available.'}</span>`;
                            } else {
                                const html = (window.marked && typeof marked.parse === 'function') ? marked.parse(aiData.suggestion) : aiData.suggestion;
                                if (box) box.innerHTML = `<strong style=\"color:#8e44ad;\">AI Suggestion:</strong><div class=\"ai-markdown\">${html}</div>`;
                            }
                        } catch (e2) {
                            if (box) box.innerHTML = `<span style=\"color:#e74c3c;\">Could not fetch AI suggestions.</span>`;
                        }
                        // Refresh stats/history after AI suggestion renders
                        loadFitness();
                    } else if (resp.status === 401) {
                        showToast('Session expired. Please log in again.');
                    } else {
                        const err = await resp.text();
                        showToast(err || 'Save failed');
                    }
                } catch (err) {
                    console.error('Save failed', err);
                    showToast('Network error');
                }
            });
        }

        // Load fitness logs after login or when navigating to fitness section
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (btn.getAttribute('data-section') === 'fitness') {
                    loadFitness();
                }
            });
        });
        // Also load once after app shows
        if (localStorage.getItem('isLoggedIn') === 'true') {
            loadFitness();
        }

        // Doctor Contact functionality
        const doctorGrid = document.getElementById('doctorGrid');
        
        const doctors = [
            {
                name: "Dr. Sarah Johnson",
                specialty: "Gynecologist",
                phone: "+1 (555) 123-4567",
                email: "sarah.johnson@healthcare.com",
                address: "123 Women's Health Clinic, City, State"
            },
            {
                name: "Dr. Emily Rodriguez",
                specialty: "Endocrinologist",
                phone: "+1 (555) 234-5678",
                email: "emily.rodriguez@healthcare.com",
                address: "456 Hormone Center, City, State"
            },
            {
                name: "Dr. Jessica Chen",
                specialty: "Reproductive Endocrinologist",
                phone: "+1 (555) 345-6789",
                email: "jessica.chen@healthcare.com",
                address: "789 Fertility Institute, City, State"
            },
            {
                name: "Dr. Amanda Patel",
                specialty: "Gynecologist",
                phone: "+1 (555) 456-7890",
                email: "amanda.patel@healthcare.com",
                address: "321 Women's Wellness Center, City, State"
            },
            {
                name: "Dr. Michelle Williams",
                specialty: "Endocrinologist",
                phone: "+1 (555) 567-8901",
                email: "michelle.williams@healthcare.com",
                address: "654 Metabolism Clinic, City, State"
            },
            {
                name: "Dr. Rachel Thompson",
                specialty: "Reproductive Endocrinologist",
                phone: "+1 (555) 678-9012",
                email: "rachel.thompson@healthcare.com",
                address: "987 Reproductive Health Center, City, State"
            }
        ];
        
        function renderDoctors() {
            doctorGrid.innerHTML = '';
            
            doctors.forEach(doctor => {
                const doctorCard = document.createElement('div');
                doctorCard.classList.add('doctor-card');
                
                doctorCard.innerHTML = `
                    <div class="doctor-name">${doctor.name}</div>
                    <div class="doctor-specialty">${doctor.specialty}</div>
                    <div class="contact-info">
                        <div class="contact-item">
                            <span><i class="fas fa-phone"></i></span>
                            <a href="tel:${doctor.phone}" class="contact-link">${doctor.phone}</a>
                        </div>
                        <div class="contact-item">
                            <span><i class="fas fa-envelope"></i></span>
                            <a href="mailto:${doctor.email}" class="contact-link">${doctor.email}</a>
                        </div>
                        <div class="contact-item">
                            <span><i class="fas fa-map-marker-alt"></i></span>
                            <span>${doctor.address}</span>
                        </div>
                    </div>
                `;
                
                doctorGrid.appendChild(doctorCard);
            });
        }
        
        // Initialize doctors on load
        renderDoctors();

        // Initialize the wizard
        showStep(1);
    </script>
    
    <!-- Connect to a Doctor Modal (no PDF preview) -->
    <div id="doctorModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.35); z-index:3000; align-items:center; justify-content:center;">
        <div style="background:#fff; border-radius:14px; width:95%; max-width:640px; box-shadow:0 18px 42px rgba(0,0,0,.25); overflow:hidden;">
            <div style="padding:1rem;">
                <h3 style="margin:0 0 .5rem; color:#6c3483;">Your Details</h3>
                <form id="doctorForm" class="login-form" style="margin-top:.25rem;">
                    <div class="form-group"><label for="pName">Full Name</label><input id="pName" class="form-control" required></div>
                    <div class="form-group"><label for="pAge">Age</label><input id="pAge" class="form-control" type="number" min="1" max="120"></div>
                    <div class="form-group"><label for="pEmail">Email</label><input id="pEmail" class="form-control" type="email"></div>
                    <div class="form-group"><label for="pPhone">Phone</label><input id="pPhone" class="form-control"></div>
                    <div class="form-group"><label for="pCity">City</label><select id="pCity" class="form-control" required></select></div>
                    <div class="form-group"><label for="doctorSelect">Doctor</label><select id="doctorSelect" class="form-control"></select></div>
                    <div style="display:flex; gap:.75rem; margin-top:.75rem;">
                        <button type="button" id="doctorCancelBtn" class="btn btn-secondary" style="flex:1;">Cancel</button>
                        <button type="submit" class="btn" style="flex:1;">Send</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
    function openDoctorModal(){
        const modal = document.getElementById('doctorModal');
        if (modal) modal.style.display = 'flex';
        const cancel = document.getElementById('doctorCancelBtn');
        if (cancel) cancel.onclick = () => { modal.style.display = 'none'; };
        const form = document.getElementById('doctorForm');
        if (form && !form._wired){
            form._wired = true;
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const token = localStorage.getItem('token');
                if (!token) { showToast('Please log in'); return; }
                const body = {
                    doctor_id: (document.getElementById('doctorSelect').value || null),
                    patient: {
                        name: document.getElementById('pName').value,
                        age: document.getElementById('pAge').value ? parseInt(document.getElementById('pAge').value) : undefined,
                        email: document.getElementById('pEmail').value || undefined,
                        phone: document.getElementById('pPhone').value || undefined,
                        city: document.getElementById('pCity').value,
                    },
                    inputs: (typeof lastPredictionInputs === 'object' && lastPredictionInputs) ? lastPredictionInputs : {},
                    prediction: (typeof lastPredictionResult === 'object' && lastPredictionResult) ? lastPredictionResult : {},
                };
                try {
                    const resp = await fetch('/doctor/consult', {
                        method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                        body: JSON.stringify(body)
                    });
                    const data = await resp.json();
                    if (resp.ok) {
                        showToast('Consult request sent');
                        document.getElementById('doctorModal').style.display = 'none';
                    } else {
                        showToast((data && data.detail) ? data.detail : 'Failed to send');
                    }
                } catch (err) {
                    console.error('Consult send failed', err);
                    showToast('Network error');
                }
            });
        }
    }
    </script>
</body>
</html>